import{r as it,h as rt}from"../vendor/1-CkNOVE2J.js";import{b0 as nt,ac as at,b1 as ot,ay as me,az as pe,aB as Pe,b2 as je}from"./index-87VEuC2R.js";import{B as st,v as ct}from"../vendor/0-BOriIG77.js";const ft={},re=(i,e,t)=>(e.has(t)?e:e.set(t,i())).get(t),lt=new WeakMap,ut=(i,e,t,r)=>{const n=re(()=>new WeakMap,lt,e),a=re(()=>new WeakMap,n,t);return re(i,a,r)};function mt(i,e,t=Object.is){return ut(()=>{const r=Symbol(),n=([s,u])=>{if(u===r)return e(s);const f=e(s,u);return t(u,f)?u:f},a=nt(s=>{const u=s(a),f=s(i);return n([f,u])});return a.init=r,a},i,e,t)}const pt=i=>typeof i?.then=="function";function ht(i=()=>{try{return window.localStorage}catch(t){(ft?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(t);return}},e){var t;let r,n;const a={getItem:(f,l)=>{var c,o;const m=h=>{if(h=h||"",r!==h){try{n=JSON.parse(h,e?.reviver)}catch{return l}r=h}return n},p=(o=(c=i())==null?void 0:c.getItem(f))!=null?o:null;return pt(p)?p.then(m):m(p)},setItem:(f,l)=>{var c;return(c=i())==null?void 0:c.setItem(f,JSON.stringify(l,void 0))},removeItem:f=>{var l;return(l=i())==null?void 0:l.removeItem(f)}},s=f=>(l,c,o)=>f(l,m=>{let p;try{p=JSON.parse(m||"")}catch{p=o}c(p)});let u;try{u=(t=i())==null?void 0:t.subscribe}catch{}return!u&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(u=(f,l)=>{if(!(i()instanceof window.Storage))return()=>{};const c=o=>{o.storageArea===i()&&o.key===f&&l(o.newValue)};return window.addEventListener("storage",c),()=>{window.removeEventListener("storage",c)}}),u&&(a.subscribe=s(u)),a}ht();const ze=i=>Symbol.iterator in i,Be=i=>"entries"in i,Ee=(i,e)=>{const t=i instanceof Map?i:new Map(i.entries()),r=e instanceof Map?e:new Map(e.entries());if(t.size!==r.size)return!1;for(const[n,a]of t)if(!r.has(n)||!Object.is(a,r.get(n)))return!1;return!0},dt=(i,e)=>{const t=i[Symbol.iterator](),r=e[Symbol.iterator]();let n=t.next(),a=r.next();for(;!n.done&&!a.done;){if(!Object.is(n.value,a.value))return!1;n=t.next(),a=r.next()}return!!n.done&&!!a.done};function xt(i,e){return Object.is(i,e)?!0:typeof i!="object"||i===null||typeof e!="object"||e===null||Object.getPrototypeOf(i)!==Object.getPrototypeOf(e)?!1:ze(i)&&ze(e)?Be(i)&&Be(e)?Ee(i,e):dt(i,e):Ee({entries:()=>Object.entries(i)},{entries:()=>Object.entries(e)})}const gt=i=>at(mt(ot,it.useCallback(e=>i(e),[]),xt)),Oi=()=>gt(vt);function vt(i){return i.w<1024&&i.w!==0}const Ui=i=>i&&i.split(".").pop()?.toUpperCase()||"UNKNOWN",he=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),Pi=typeof window>"u"?!1:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window;var G={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Me;function wt(){return Me||(Me=1,G.read=function(i,e,t,r,n){var a,s,u=n*8-r-1,f=(1<<u)-1,l=f>>1,c=-7,o=t?n-1:0,m=t?-1:1,p=i[e+o];for(o+=m,a=p&(1<<-c)-1,p>>=-c,c+=u;c>0;a=a*256+i[e+o],o+=m,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=r;c>0;s=s*256+i[e+o],o+=m,c-=8);if(a===0)a=1-l;else{if(a===f)return s?NaN:(p?-1:1)*(1/0);s=s+Math.pow(2,r),a=a-l}return(p?-1:1)*s*Math.pow(2,a-r)},G.write=function(i,e,t,r,n,a){var s,u,f,l=a*8-n-1,c=(1<<l)-1,o=c>>1,m=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,h=r?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-s))<1&&(s--,f*=2),s+o>=1?e+=m/f:e+=m*Math.pow(2,1-o),e*f>=2&&(s++,f/=2),s+o>=c?(u=0,s=c):s+o>=1?(u=(e*f-1)*Math.pow(2,n),s=s+o):(u=e*Math.pow(2,o-1)*Math.pow(2,n),s=0));n>=8;i[t+p]=u&255,p+=h,u/=256,n-=8);for(s=s<<n|u,l+=n;l>0;i[t+p]=s&255,p+=h,s/=256,l-=8);i[t+p-h]|=y*128}),G}wt();function k(i){return new DataView(i.buffer,i.byteOffset)}const yt={len:1,get(i,e){return k(i).getUint8(e)},put(i,e,t){return k(i).setUint8(e,t),e+1}},g={len:2,get(i,e){return k(i).getUint16(e,!0)},put(i,e,t){return k(i).setUint16(e,t,!0),e+2}},H={len:2,get(i,e){return k(i).getUint16(e)},put(i,e,t){return k(i).setUint16(e,t),e+2}},w={len:4,get(i,e){return k(i).getUint32(e,!0)},put(i,e,t){return k(i).setUint32(e,t,!0),e+4}},bt={len:4,get(i,e){return k(i).getUint32(e)},put(i,e,t){return k(i).setUint32(e,t),e+4}},kt={len:4,get(i,e){return k(i).getInt32(e)},put(i,e,t){return k(i).setInt32(e,t),e+4}},Ct={len:8,get(i,e){return k(i).getBigUint64(e,!0)},put(i,e,t){return k(i).setBigUint64(e,t,!0),e+8}};class I{constructor(e,t){this.len=e,this.encoding=t,this.textDecoder=new TextDecoder(t)}get(e,t){return this.textDecoder.decode(e.subarray(t,t+this.len))}}const Ft="End-Of-Stream";class z extends Error{constructor(){super(Ft),this.name="EndOfStreamError"}}class St extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class Ve{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(e,t=!1){const r=await this.read(e,t);return this.peekQueue.push(e.subarray(0,r)),r}async read(e,t=!1){if(e.length===0)return 0;let r=this.readFromPeekBuffer(e);if(this.endOfStream||(r+=await this.readRemainderFromStream(e.subarray(r),t)),r===0&&!t)throw new z;return r}readFromPeekBuffer(e){let t=e.length,r=0;for(;this.peekQueue.length>0&&t>0;){const n=this.peekQueue.pop();if(!n)throw new Error("peekData should be defined");const a=Math.min(n.length,t);e.set(n.subarray(0,a),r),r+=a,t-=a,a<n.length&&this.peekQueue.push(n.subarray(a))}return r}async readRemainderFromStream(e,t){let r=0;for(;r<e.length&&!this.endOfStream;){if(this.interrupted)throw new St;const n=await this.readFromStream(e.subarray(r),t);if(n===0)break;r+=n}if(!t&&r<e.length)throw new z;return r}}class zt extends Ve{constructor(e){super(),this.reader=e}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class Bt extends zt{async readFromStream(e,t){if(e.length===0)return 0;const r=await this.reader.read(new Uint8Array(e.length),{min:t?void 0:e.length});return r.done&&(this.endOfStream=r.done),r.value?(e.set(r.value),r.value.length):0}}class Te extends Ve{constructor(e){super(),this.reader=e,this.buffer=null}writeChunk(e,t){const r=Math.min(t.length,e.length);return e.set(t.subarray(0,r)),r<t.length?this.buffer=t.subarray(r):this.buffer=null,r}async readFromStream(e,t){if(e.length===0)return 0;let r=0;for(this.buffer&&(r+=this.writeChunk(e,this.buffer));r<e.length&&!this.endOfStream;){const n=await this.reader.read();if(n.done){this.endOfStream=!0;break}n.value&&(r+=this.writeChunk(e.subarray(r),n.value))}if(!t&&r===0&&this.endOfStream)throw new z;return r}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}function Et(i){try{const e=i.getReader({mode:"byob"});return e instanceof ReadableStreamDefaultReader?new Te(e):new Bt(e)}catch(e){if(e instanceof TypeError)return new Te(i.getReader());throw e}}class $e{constructor(e){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=e?.onClose,e?.abortSignal&&e.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(e,t=this.position){const r=new Uint8Array(e.len);if(await this.readBuffer(r,{position:t})<e.len)throw new z;return e.get(r,0)}async peekToken(e,t=this.position){const r=new Uint8Array(e.len);if(await this.peekBuffer(r,{position:t})<e.len)throw new z;return e.get(r,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new z;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new z;return e.get(this.numBuffer,0)}async ignore(e){if(this.fileInfo.size!==void 0){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){await this.abort(),await this.onClose?.()}normalizeOptions(e,t){if(!this.supportsRandomAccess()&&t&&t.position!==void 0&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:!1,offset:0,length:e.length,position:this.position,...t}}abort(){return Promise.resolve()}}const Mt=256e3;class Tt extends $e{constructor(e,t){super(t),this.streamReader=e,this.fileInfo=t?.fileInfo??{}}async readBuffer(e,t){const r=this.normalizeOptions(e,t),n=r.position-this.position;if(n>0)return await this.ignore(n),this.readBuffer(e,t);if(n<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(r.length===0)return 0;const a=await this.streamReader.read(e.subarray(0,r.length),r.mayBeLess);if(this.position+=a,(!t||!t.mayBeLess)&&a<r.length)throw new z;return a}async peekBuffer(e,t){const r=this.normalizeOptions(e,t);let n=0;if(r.position){const a=r.position-this.position;if(a>0){const s=new Uint8Array(r.length+a);return n=await this.peekBuffer(s,{mayBeLess:r.mayBeLess}),e.set(s.subarray(a)),n-a}if(a<0)throw new Error("Cannot peek from a negative offset in a stream")}if(r.length>0){try{n=await this.streamReader.peek(e.subarray(0,r.length),r.mayBeLess)}catch(a){if(t?.mayBeLess&&a instanceof z)return 0;throw a}if(!r.mayBeLess&&n<r.length)throw new z}return n}async ignore(e){const t=Math.min(Mt,e),r=new Uint8Array(t);let n=0;for(;n<e;){const a=e-n,s=await this.readBuffer(r,{length:Math.min(t,a)});if(s<0)return s;n+=s}return n}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class It extends $e{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo={...t?.fileInfo??{},size:e.length}}async readBuffer(e,t){t?.position&&(this.position=t.position);const r=await this.peekBuffer(e,t);return this.position+=r,r}async peekBuffer(e,t){const r=this.normalizeOptions(e,t),n=Math.min(this.uint8Array.length-r.position,r.length);if(!r.mayBeLess&&n<r.length)throw new z;return e.set(this.uint8Array.subarray(r.position,r.position+n)),n}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(e){this.position=e}}function At(i,e){const t=Et(i),r=e??{},n=r.onClose;return r.onClose=async()=>{if(await t.close(),n)return n()},new Tt(t,r)}function Dt(i,e){return new It(i,e)}var F=Uint8Array,j=Uint16Array,Rt=Int32Array,Ne=new F([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_e=new F([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lt=new F([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),He=function(i,e){for(var t=new j(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new Rt(t[30]),r=1;r<30;++r)for(var a=t[r];a<t[r+1];++a)n[a]=a-t[r]<<5|r;return{b:t,r:n}},qe=He(Ne,2),We=qe.b,Ot=qe.r;We[28]=258,Ot[258]=28;var Ut=He(_e,0),Pt=Ut.b,ue=new j(32768);for(var d=0;d<32768;++d){var L=(d&43690)>>1|(d&21845)<<1;L=(L&52428)>>2|(L&13107)<<2,L=(L&61680)>>4|(L&3855)<<4,ue[d]=((L&65280)>>8|(L&255)<<8)>>1}var q=(function(i,e,t){for(var r=i.length,n=0,a=new j(e);n<r;++n)i[n]&&++a[i[n]-1];var s=new j(e);for(n=1;n<e;++n)s[n]=s[n-1]+a[n-1]<<1;var u;if(t){u=new j(1<<e);var f=15-e;for(n=0;n<r;++n)if(i[n])for(var l=n<<4|i[n],c=e-i[n],o=s[i[n]-1]++<<c,m=o|(1<<c)-1;o<=m;++o)u[ue[o]>>f]=l}else for(u=new j(r),n=0;n<r;++n)i[n]&&(u[n]=ue[s[i[n]-1]++]>>15-i[n]);return u}),W=new F(288);for(var d=0;d<144;++d)W[d]=8;for(var d=144;d<256;++d)W[d]=9;for(var d=256;d<280;++d)W[d]=7;for(var d=280;d<288;++d)W[d]=8;var Ke=new F(32);for(var d=0;d<32;++d)Ke[d]=5;var jt=q(W,9,1),Vt=q(Ke,5,1),ne=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},E=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(e&7)&t},ae=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},$t=function(i){return(i+7)/8|0},Nt=function(i,e,t){return(t==null||t>i.length)&&(t=i.length),new F(i.subarray(e,t))},_t=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(i,e,t){var r=new Error(e||_t[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,C),!t)throw r;return r},de=function(i,e,t,r){var n=i.length,a=0;if(!n||e.f&&!e.l)return t||new F(0);var s=!t,u=s||e.i!=2,f=e.i;s&&(t=new F(n*3));var l=function(Ce){var Fe=t.length;if(Ce>Fe){var Se=new F(Math.max(Fe*2,Ce));Se.set(t),t=Se}},c=e.f||0,o=e.p||0,m=e.b||0,p=e.l,h=e.d,y=e.m,x=e.n,v=n*8;do{if(!p){c=E(i,o,1);var B=E(i,o+1,3);if(o+=3,B)if(B==1)p=jt,h=Vt,y=9,x=5;else if(B==2){var K=E(i,o,31)+257,O=E(i,o+10,15)+4,J=K+E(i,o+5,31)+1;o+=14;for(var D=new F(J),N=new F(19),S=0;S<O;++S)N[Lt[S]]=E(i,o+S*3,7);o+=O*3;for(var ge=ne(N),Xe=(1<<ge)-1,Ze=q(N,ge,1),S=0;S<J;){var ve=Ze[E(i,o,Xe)];o+=ve&15;var b=ve>>4;if(b<16)D[S++]=b;else{var U=0,Q=0;for(b==16?(Q=3+E(i,o,3),o+=2,U=D[S-1]):b==17?(Q=3+E(i,o,7),o+=3):b==18&&(Q=11+E(i,o,127),o+=7);Q--;)D[S++]=U}}var we=D.subarray(0,K),R=D.subarray(K);y=ne(we),x=ne(R),p=q(we,y,1),h=q(R,x,1)}else C(1);else{var b=$t(o)+4,$=i[b-4]|i[b-3]<<8,A=b+$;if(A>n){f&&C(0);break}u&&l(m+$),t.set(i.subarray(b,A),m),e.b=m+=$,e.p=o=A*8,e.f=c;continue}if(o>v){f&&C(0);break}}u&&l(m+131072);for(var Ye=(1<<y)-1,et=(1<<x)-1,ee=o;;ee=o){var U=p[ae(i,o)&Ye],P=U>>4;if(o+=U&15,o>v){f&&C(0);break}if(U||C(2),P<256)t[m++]=P;else if(P==256){ee=o,p=null;break}else{var ye=P-254;if(P>264){var S=P-257,_=Ne[S];ye=E(i,o,(1<<_)-1)+We[S],o+=_}var te=h[ae(i,o)&et],ie=te>>4;te||C(3),o+=te&15;var R=Pt[ie];if(ie>3){var _=_e[ie];R+=ae(i,o)&(1<<_)-1,o+=_}if(o>v){f&&C(0);break}u&&l(m+131072);var be=m+ye;if(m<R){var ke=a-R,tt=Math.min(R,be);for(ke+m<0&&C(3);m<tt;++m)t[m]=r[ke+m]}for(;m<be;++m)t[m]=t[m-R]}}e.l=p,e.p=ee,e.b=m,e.f=c,p&&(c=1,e.m=y,e.d=h,e.n=x)}while(!c);return m!=t.length&&s?Nt(t,0,m):t.subarray(0,m)},Ht=new F(0),qt=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&C(6,"invalid gzip data");var e=i[3],t=10;e&4&&(t+=(i[10]|i[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!i[t++]);return t+(e&2)},Wt=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},Kt=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&C(6,"invalid zlib data"),(i[1]>>5&1)==1&&C(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function Jt(i,e){return de(i,{i:2},e,e)}function Qt(i,e){var t=qt(i);return t+8>i.length&&C(6,"invalid gzip data"),de(i.subarray(t,-8),{i:2},new F(Wt(i)),e)}function Gt(i,e){return de(i.subarray(Kt(i),-4),{i:2},e,e)}function Xt(i,e){return i[0]==31&&i[1]==139&&i[2]==8?Qt(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?Jt(i,e):Gt(i,e)}var Zt=typeof TextDecoder<"u"&&new TextDecoder,Yt=0;try{Zt.decode(Ht,{stream:!0}),Yt=1}catch{}var X={exports:{}},oe,Ie;function ei(){if(Ie)return oe;Ie=1;var i=1e3,e=i*60,t=e*60,r=t*24,n=r*7,a=r*365.25;oe=function(c,o){o=o||{};var m=typeof c;if(m==="string"&&c.length>0)return s(c);if(m==="number"&&isFinite(c))return o.long?f(c):u(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function s(c){if(c=String(c),!(c.length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(o){var m=parseFloat(o[1]),p=(o[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return m*a;case"weeks":case"week":case"w":return m*n;case"days":case"day":case"d":return m*r;case"hours":case"hour":case"hrs":case"hr":case"h":return m*t;case"minutes":case"minute":case"mins":case"min":case"m":return m*e;case"seconds":case"second":case"secs":case"sec":case"s":return m*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function u(c){var o=Math.abs(c);return o>=r?Math.round(c/r)+"d":o>=t?Math.round(c/t)+"h":o>=e?Math.round(c/e)+"m":o>=i?Math.round(c/i)+"s":c+"ms"}function f(c){var o=Math.abs(c);return o>=r?l(c,o,r,"day"):o>=t?l(c,o,t,"hour"):o>=e?l(c,o,e,"minute"):o>=i?l(c,o,i,"second"):c+" ms"}function l(c,o,m,p){var h=o>=m*1.5;return Math.round(c/m)+" "+p+(h?"s":"")}return oe}var se,Ae;function ti(){if(Ae)return se;Ae=1;function i(e){r.debug=r,r.default=r,r.coerce=l,r.disable=u,r.enable=a,r.enabled=f,r.humanize=ei(),r.destroy=c,Object.keys(e).forEach(o=>{r[o]=e[o]}),r.names=[],r.skips=[],r.formatters={};function t(o){let m=0;for(let p=0;p<o.length;p++)m=(m<<5)-m+o.charCodeAt(p),m|=0;return r.colors[Math.abs(m)%r.colors.length]}r.selectColor=t;function r(o){let m,p=null,h,y;function x(...v){if(!x.enabled)return;const B=x,b=Number(new Date),$=b-(m||b);B.diff=$,B.prev=m,B.curr=b,m=b,v[0]=r.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let A=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(O,J)=>{if(O==="%%")return"%";A++;const D=r.formatters[J];if(typeof D=="function"){const N=v[A];O=D.call(B,N),v.splice(A,1),A--}return O}),r.formatArgs.call(B,v),(B.log||r.log).apply(B,v)}return x.namespace=o,x.useColors=r.useColors(),x.color=r.selectColor(o),x.extend=n,x.destroy=r.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(h!==r.namespaces&&(h=r.namespaces,y=r.enabled(o)),y),set:v=>{p=v}}),typeof r.init=="function"&&r.init(x),x}function n(o,m){const p=r(this.namespace+(typeof m>"u"?":":m)+o);return p.log=this.log,p}function a(o){r.save(o),r.namespaces=o,r.names=[],r.skips=[];const m=(typeof o=="string"?o:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const p of m)p[0]==="-"?r.skips.push(p.slice(1)):r.names.push(p)}function s(o,m){let p=0,h=0,y=-1,x=0;for(;p<o.length;)if(h<m.length&&(m[h]===o[p]||m[h]==="*"))m[h]==="*"?(y=h,x=p,h++):(p++,h++);else if(y!==-1)h=y+1,x++,p=x;else return!1;for(;h<m.length&&m[h]==="*";)h++;return h===m.length}function u(){const o=[...r.names,...r.skips.map(m=>"-"+m)].join(",");return r.enable(""),o}function f(o){for(const m of r.skips)if(s(o,m))return!1;for(const m of r.names)if(s(o,m))return!0;return!1}function l(o){return o instanceof Error?o.stack||o.message:o}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return se=i,se}var De;function ii(){return De||(De=1,(function(i,e){var t={};e.formatArgs=n,e.save=a,e.load=s,e.useColors=r,e.storage=u(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let o=0,m=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(o++,p==="%c"&&(m=o))}),l.splice(m,0,c)}e.log=console.debug||console.log||(()=>{});function a(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=t.DEBUG),l}function u(){try{return localStorage}catch{}}i.exports=ti()(e);const{formatters:f}=i.exports;f.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(X,X.exports)),X.exports}var ri=ii();const ni=rt(ri),V={LocalFileHeader:67324752,DataDescriptor:134695760,CentralFileHeader:33639248,EndOfCentralDirectory:101010256},Re={get(i){return g.get(i,6),{signature:w.get(i,0),compressedSize:w.get(i,8),uncompressedSize:w.get(i,12)}},len:16},ai={get(i){const e=g.get(i,6);return{signature:w.get(i,0),minVersion:g.get(i,4),dataDescriptor:!!(e&8),compressedMethod:g.get(i,8),compressedSize:w.get(i,18),uncompressedSize:w.get(i,22),filenameLength:g.get(i,26),extraFieldLength:g.get(i,28),filename:null}},len:30},oi={get(i){return{signature:w.get(i,0),nrOfThisDisk:g.get(i,4),nrOfThisDiskWithTheStart:g.get(i,6),nrOfEntriesOnThisDisk:g.get(i,8),nrOfEntriesOfSize:g.get(i,10),sizeOfCd:w.get(i,12),offsetOfStartOfCd:w.get(i,16),zipFileCommentLength:g.get(i,20)}},len:22},si={get(i){const e=g.get(i,8);return{signature:w.get(i,0),minVersion:g.get(i,6),dataDescriptor:!!(e&8),compressedMethod:g.get(i,10),compressedSize:w.get(i,20),uncompressedSize:w.get(i,24),filenameLength:g.get(i,28),extraFieldLength:g.get(i,30),fileCommentLength:g.get(i,32),relativeOffsetOfLocalHeader:w.get(i,42),filename:null}},len:46};function Je(i){const e=new Uint8Array(w.len);return w.put(e,0,i),e}const M=ni("tokenizer:inflate"),ce=256*1024,ci=Je(V.DataDescriptor),Z=Je(V.EndOfCentralDirectory);class fi{constructor(e){this.tokenizer=e,this.syncBuffer=new Uint8Array(ce)}async isZip(){return await this.peekSignature()===V.LocalFileHeader}peekSignature(){return this.tokenizer.peekToken(w)}async findEndOfCentralDirectoryLocator(){const e=this.tokenizer,t=Math.min(16*1024,e.fileInfo.size),r=this.syncBuffer.subarray(0,t);await this.tokenizer.readBuffer(r,{position:e.fileInfo.size-t});for(let n=r.length-4;n>=0;n--)if(r[n]===Z[0]&&r[n+1]===Z[1]&&r[n+2]===Z[2]&&r[n+3]===Z[3])return e.fileInfo.size-t+n;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess()){M("Cannot reading central-directory without random-read support");return}M("Reading central-directory...");const e=this.tokenizer.position,t=await this.findEndOfCentralDirectoryLocator();if(t>0){M("Central-directory 32-bit signature found");const r=await this.tokenizer.readToken(oi,t),n=[];this.tokenizer.setPosition(r.offsetOfStartOfCd);for(let a=0;a<r.nrOfEntriesOfSize;++a){const s=await this.tokenizer.readToken(si);if(s.signature!==V.CentralFileHeader)throw new Error("Expected Central-File-Header signature");s.filename=await this.tokenizer.readToken(new I(s.filenameLength,"utf-8")),await this.tokenizer.ignore(s.extraFieldLength),await this.tokenizer.ignore(s.fileCommentLength),n.push(s),M(`Add central-directory file-entry: n=${a+1}/${n.length}: filename=${n[a].filename}`)}return this.tokenizer.setPosition(e),n}this.tokenizer.setPosition(e)}async unzip(e){const t=await this.readCentralDirectory();if(t)return this.iterateOverCentralDirectory(t,e);let r=!1;do{const n=await this.readLocalFileHeader();if(!n)break;const a=e(n);r=!!a.stop;let s;if(await this.tokenizer.ignore(n.extraFieldLength),n.dataDescriptor&&n.compressedSize===0){const u=[];let f=ce;M("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let l=-1;for(;l<0&&f===ce;){f=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),l=li(this.syncBuffer.subarray(0,f),ci);const c=l>=0?l:f;if(a.handler){const o=new Uint8Array(c);await this.tokenizer.readBuffer(o),u.push(o)}else await this.tokenizer.ignore(c)}M(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),a.handler&&await this.inflate(n,ui(u),a.handler)}else a.handler?(M(`Reading compressed-file-data: ${n.compressedSize} bytes`),s=new Uint8Array(n.compressedSize),await this.tokenizer.readBuffer(s),await this.inflate(n,s,a.handler)):(M(`Ignoring compressed-file-data: ${n.compressedSize} bytes`),await this.tokenizer.ignore(n.compressedSize));if(M(`Reading data-descriptor at pos=${this.tokenizer.position}`),n.dataDescriptor&&(await this.tokenizer.readToken(Re)).signature!==134695760)throw new Error(`Expected data-descriptor-signature at position ${this.tokenizer.position-Re.len}`)}while(!r)}async iterateOverCentralDirectory(e,t){for(const r of e){const n=t(r);if(n.handler){this.tokenizer.setPosition(r.relativeOffsetOfLocalHeader);const a=await this.readLocalFileHeader();if(a){await this.tokenizer.ignore(a.extraFieldLength);const s=new Uint8Array(r.compressedSize);await this.tokenizer.readBuffer(s),await this.inflate(a,s,n.handler)}}if(n.stop)break}}inflate(e,t,r){if(e.compressedMethod===0)return r(t);M(`Decompress filename=${e.filename}, compressed-size=${t.length}`);const n=Xt(t);return r(n)}async readLocalFileHeader(){const e=await this.tokenizer.peekToken(w);if(e===V.LocalFileHeader){const t=await this.tokenizer.readToken(ai);return t.filename=await this.tokenizer.readToken(new I(t.filenameLength,"utf-8")),t}if(e===V.CentralFileHeader)return!1;throw e===3759263696?new Error("Encrypted ZIP"):new Error("Unexpected signature")}}function li(i,e){const t=i.length,r=e.length;if(r>t)return-1;for(let n=0;n<=t-r;n++){let a=!0;for(let s=0;s<r;s++)if(i[n+s]!==e[s]){a=!1;break}if(a)return n}return-1}function ui(i){const e=i.reduce((n,a)=>n+a.length,0),t=new Uint8Array(e);let r=0;for(const n of i)t.set(n,r),r+=n.length;return t}new globalThis.TextDecoder("utf8");new globalThis.TextEncoder;Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function Le(i){const{byteLength:e}=i;if(e===6)return i.getUint16(0)*2**32+i.getUint32(2);if(e===5)return i.getUint8(0)*2**32+i.getUint32(1);if(e===4)return i.getUint32(0);if(e===3)return i.getUint8(0)*2**16+i.getUint16(1);if(e===2)return i.getUint16(0);if(e===1)return i.getUint8(0)}function mi(i){return[...i].map(e=>e.charCodeAt(0))}function pi(i,e=0){const t=Number.parseInt(new I(6).get(i,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(t))return!1;let r=256;for(let n=e;n<e+148;n++)r+=i[n];for(let n=e+156;n<e+512;n++)r+=i[n];return t===r}const hi={get:(i,e)=>i[e+3]&127|i[e+2]<<7|i[e+1]<<14|i[e]<<21,len:4},di=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","rm","ppsm","ppsx"],xi=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia"],Y=4100;async function Qe(i,e){return new Ge(e).fromBlob(i)}function fe(i){switch(i=i.toLowerCase(),i){case"application/epub+zip":return{ext:"epub",mime:i};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:i};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:i};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:i};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:i};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:i};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:i};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:i};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:i};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:i};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:i};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:i};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:i};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:i};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:i};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:i};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"}}}function T(i,e,t){t={offset:0,...t};for(const[r,n]of e.entries())if(t.mask){if(n!==(t.mask[r]&i[r+t.offset]))return!1}else if(n!==i[r+t.offset])return!1;return!0}class Ge{constructor(e){this.options={mpegOffsetTolerance:0,...e},this.detectors=[...e?.customDetectors??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:e?.signal}}async fromTokenizer(e){const t=e.position;for(const r of this.detectors){const n=await r.detect(e);if(n)return n;if(t!==e.position)return}}async fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(t?.length>1)return this.fromTokenizer(Dt(t,this.tokenizerOptions))}async fromBlob(e){return this.fromStream(e.stream())}async fromStream(e){const t=await At(e,this.tokenizerOptions);try{return await this.fromTokenizer(t)}finally{await t.close()}}async toDetectionStream(e,t){const{sampleSize:r=Y}=t;let n,a;const s=e.getReader({mode:"byob"});try{const{value:l,done:c}=await s.read(new Uint8Array(r));if(a=l,!c&&l)try{n=await this.fromBuffer(l.subarray(0,r))}catch(o){if(!(o instanceof z))throw o;n=void 0}a=l}finally{s.releaseLock()}const u=new TransformStream({async start(l){l.enqueue(a)},transform(l,c){c.enqueue(l)}}),f=e.pipeThrough(u);return f.fileType=n,f}check(e,t){return T(this.buffer,e,t)}checkString(e,t){return this.check(mi(e),t)}detectConfident=async e=>{if(this.buffer=new Uint8Array(Y),e.fileInfo.size===void 0&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(hi);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),this.fromTokenizer(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let t;return await new fi(e).unzip(r=>{switch(r.filename){case"META-INF/mozilla.rsa":return t={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return t={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(n){const a=new TextDecoder("utf-8").decode(n).trim();t=fe(a)},stop:!0};case"[Content_Types].xml":return{async handler(n){let a=new TextDecoder("utf-8").decode(n);const s=a.indexOf('.main+xml"');if(s===-1){const u="application/vnd.ms-package.3dmanufacturing-3dmodel+xml";a.includes(`ContentType="${u}"`)&&(t=fe(u))}else{a=a.slice(0,Math.max(0,s));const u=a.lastIndexOf('"'),f=a.slice(Math.max(0,u+1));t=fe(f)}},stop:!0};default:return/classes\d*\.dex/.test(r.filename)?(t={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0}):{}}}),t??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const t=new Uint8Array(8);return await e.readBuffer(t),T(t,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:T(t,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:T(t,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:T(t,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:T(t,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:T(t,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const t=await this.readTiffHeader(!1);if(t)return t}if(this.check([77,77])){const t=await this.readTiffHeader(!0);if(t)return t}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function t(){const u=await e.peekNumber(yt);let f=128,l=0;for(;(u&f)===0&&f!==0;)++l,f>>=1;const c=new Uint8Array(l+1);return await e.readBuffer(c),c}async function r(){const u=await t(),f=await t();f[0]^=128>>f.length-1;const l=Math.min(6,f.length),c=new DataView(u.buffer),o=new DataView(f.buffer,f.length-l,l);return{id:Le(c),len:Le(o)}}async function n(u){for(;u>0;){const f=await r();if(f.id===17026)return(await e.readToken(new I(f.len))).replaceAll(/\00.*$/g,"");await e.ignore(f.len),--u}}const a=await r();switch(await n(a.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const t=new I(4,"latin1").get(this.buffer,2);if(t.match("^d*")&&t>=1e3&&t<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await e.ignore(8),await e.readToken(new I(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.checkString("WEBVTT")&&[`
`,"\r","	"," ","\0"].some(t=>this.checkString(t,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){await e.ignore(8);async function t(){return{length:await e.readToken(kt),type:await e.readToken(new I(4,"latin1"))}}do{const r=await t();if(r.length<0)return;switch(r.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(r.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&(this.buffer[8]&96)!==0){const t=new I(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(t){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return t.startsWith("3g")?t.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function t(){const r=new Uint8Array(16);return await e.readBuffer(r),{id:r,size:Number(await e.readToken(Ct))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const r=await t();let n=r.size-24;if(T(r.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const a=new Uint8Array(16);if(n-=await e.readBuffer(a),T(a,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(T(a,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(n)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new I(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const t=new DataView(this.buffer.buffer).getUint32(12,!0);if(t>12&&this.buffer.length>=t+16)try{const r=new TextDecoder().decode(this.buffer.subarray(16,t+16));if(JSON.parse(r).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \0"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\0",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&pi(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"}};detectImprecise=async e=>{if(this.buffer=new Uint8Array(Y),await e.peekBuffer(this.buffer,{length:Math.min(8,e.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await e.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,e.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let t=0;t<=this.options.mpegOffsetTolerance;++t){const r=this.scanMpeg(t);if(r)return r}};async readTiffTag(e){const t=await this.tokenizer.readToken(e?H:g);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?H:g);for(let r=0;r<t;++r){const n=await this.readTiffTag(e);if(n)return n}}async readTiffHeader(e){const t=(e?H:g).get(this.buffer,2),r=(e?bt:w).get(this.buffer,4);if(t===42){if(r>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r>=8){const a=(e?H:g).get(this.buffer,8),s=(e?H:g).get(this.buffer,10);if(a===28&&s===254||a===31&&s===11)return{ext:"nef",mime:"image/x-nikon-nef"}}}return await this.tokenizer.ignore(r),await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(t===43)return{ext:"tif",mime:"image/tiff"}}scanMpeg(e){if(this.check([255,224],{offset:e,mask:[255,224]})){if(this.check([16],{offset:e+1,mask:[22]}))return this.check([8],{offset:e+1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:e+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:e+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:e+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}new Set(di);new Set(xi);const gi=Object.freeze(Object.defineProperty({__proto__:null,FileTypeParser:Ge,fileTypeFromBlob:Qe,reasonableDetectionSizeInBytes:Y},Symbol.toStringTag,{value:"Module"}));class vi{maxConcurrent;queue=[];activeCount=0;constructor(e={}){const{maxConcurrent:t=2}=e;this.maxConcurrent=Math.max(1,t)}enqueue(e){return new Promise((t,r)=>{const n={execute:e,resolve:t,reject:r};this.queue.push(n),this.drainQueue()})}getActiveCount(){return this.activeCount}getPendingCount(){return this.queue.length}getMaxConcurrent(){return this.maxConcurrent}setMaxConcurrent(e){if(!Number.isFinite(e))throw new TypeError("maxConcurrent must be a finite number");const t=Math.max(1,Math.floor(e));t!==this.maxConcurrent&&(this.maxConcurrent=t,this.drainQueue())}drainQueue(){if(this.activeCount>=this.maxConcurrent)return;const e=this.queue.shift();e&&(this.activeCount+=1,(async()=>{try{const t=await e.execute();e.resolve(t)}catch(t){e.reject(t)}finally{this.activeCount=Math.max(0,this.activeCount-1),this.drainQueue()}})())}}class xe{maxSize;cache;cleanupFn;constructor(e=10,t){this.maxSize=e,this.cache=new Map,this.cleanupFn=t}get(e){const t=this.cache.get(e);if(t!==void 0)return this.cache.delete(e),this.cache.set(e,t),t}set(e,t){if(this.cache.has(e)){const r=this.cache.get(e);this._cleanup(r,e,`Replacing existing cache entry for ${String(e)}`),this.cache.delete(e)}else if(this.cache.size>=this.maxSize){const r=this.cache.keys().next().value;if(r!==void 0){const n=this.cache.get(r);this._cleanup(n,r,`LRU eviction: ${String(r)}`),this.cache.delete(r)}}this.cache.set(e,t),console.info(`LRU Cache: Added ${String(e)}, cache size: ${this.cache.size}/${this.maxSize}`)}delete(e){const t=this.cache.get(e);return t!==void 0?(this._cleanup(t,e,`Manual deletion: ${String(e)}`),this.cache.delete(e)):!1}has(e){return this.cache.has(e)}clear(){let e=0;for(const[t,r]of this.cache.entries())this._cleanup(r,t,`Cache clear: ${String(t)}`),e++;this.cache.clear(),console.info(`LRU Cache: Cleared ${e} cached items`)}size(){return this.cache.size}getStats(){return{size:this.cache.size,maxSize:this.maxSize,keys:Array.from(this.cache.keys())}}values(){return this.cache.values()}entries(){return this.cache.entries()}_cleanup(e,t,r){if(this.cleanupFn)try{this.cleanupFn(e,t,r)}catch(n){console.warn(`LRU Cache cleanup failed (${r}):`,n)}}}class wi{getName(){return"HEIC"}getSupportedFormats(){return["image/heic","image/heif"]}async shouldConvert(e){try{return!ki()}catch(t){return console.error("HEIC browser support detection failed:",t),!1}}async convert(e,t,r){const{onLoadingStateUpdate:n}=r||{};try{const a=me.get(pe);n?.({isConverting:!0,isQueueWaiting:!1,conversionMessage:a.t("loading.heic.converting"),isHeicFormat:!0,loadingProgress:100,loadedBytes:e.size,totalBytes:e.size});const s=await Ci(e,t);return{url:s.url,convertedSize:s.convertedSize,format:s.format,originalSize:s.originalSize}}catch(a){throw console.error("HEIC conversion failed:",a),new Error(`HEIC conversion failed: ${a}`)}}}const Oe=new xe(10,(i,e,t)=>{try{URL.revokeObjectURL(i.url),console.info(`HEIC cache: Revoked blob URL - ${t}`)}catch(r){console.warn(`Failed to revoke HEIC blob URL (${t}):`,r)}});function yi(i,e){const t=e.quality||1,r=e.format||"image/jpeg";return`${i}-${t}-${r}`}async function bi(i){try{return await ct(i)}catch(e){return console.warn("Failed to detect HEIC format:",e),!1}}const ki=()=>{const e=navigator.userAgent.match(/version\/(\d+)/i)?.[1],t=e?Number.parseInt(e,10):0;return he&&t>=17};async function Ci(i,e,t={}){const{quality:r=1,format:n="image/jpeg"}=t,a=yi(e,t),s=Oe.get(a);if(s)return console.info("Using cached HEIC conversion result",s),s;try{if(!await bi(i))throw new Error("File is not in HEIC/HEIF format");const f=await st({blob:i,type:n,quality:r}),c={url:URL.createObjectURL(f),originalSize:i.size,convertedSize:f.size,format:n};return Oe.set(a,c),console.info(`HEIC conversion completed and cached: ${(i.size/1024).toFixed(1)}KB  ${(f.size/1024).toFixed(1)}KB`),c}catch(u){throw console.error("HEIC conversion failed:",u),new Error(`Failed to convert HEIC image: ${u instanceof Error?u.message:"Unknown error"}`)}}class Fi{getName(){return"TIFF"}getSupportedFormats(){return["image/tiff","image/tif"]}async shouldConvert(e){return!this.isBrowserSupportTiff()}async convert(e,t,r){const{onLoadingStateUpdate:n}=r||{};try{n?.({isConverting:!0,isQueueWaiting:!1,conversionMessage:"Converting TIFF image..."});const a=await this.convertTiffToJpeg(e);return{url:a.url,convertedSize:a.size,format:"image/jpeg",originalSize:e.size}}catch(a){throw console.error("TIFF conversion failed:",a),new Error(`TIFF conversion failed: ${a}`)}}isBrowserSupportTiff(){return!!he}async convertTiffToJpeg(e){try{const t=await Pe(()=>import("./index-uHGvuG-h.js"),[]),r=await e.arrayBuffer(),n=t.decode(r);if(!n||n.length===0)throw new Error("Failed to decode TIFF image");const a=n[0],{width:s,height:u,data:f,bitsPerSample:l}=a,c=document.createElement("canvas"),o=c.getContext("2d");if(!o)throw new Error("Failed to get canvas context");c.width=s,c.height=u;const m=o.createImageData(s,u),p=m.data;return this.processPixelData(f,p,l,a.alpha),o.putImageData(m,0,0),new Promise((h,y)=>{c.toBlob(x=>{if(x){const v=URL.createObjectURL(x);h({url:v,size:x.size})}else y(new Error("Failed to convert TIFF to JPEG"))},"image/jpeg",1)})}catch(t){throw console.error("TIFF to JPEG conversion failed:",t),t}}processPixelData(e,t,r,n=!1){const a=n?4:3,s=t.length/4;for(let u=0;u<s;u++){const f=u*a,l=u*4;switch(r){case 8:{const c=e;t[l]=c[f]||0,t[l+1]=a>1?c[f+1]||0:c[f]||0,t[l+2]=a>2?c[f+2]||0:c[f]||0,t[l+3]=n&&c[f+3]||255;break}case 16:{const c=e;t[l]=Math.round((c[f]||0)/257),t[l+1]=a>1?Math.round((c[f+1]||0)/257):Math.round((c[f]||0)/257),t[l+2]=a>2?Math.round((c[f+2]||0)/257):Math.round((c[f]||0)/257),t[l+3]=n?Math.round((c[f+3]||65535)/257):255;break}case 32:{const c=e;t[l]=Math.round((c[f]||0)*255),t[l+1]=a>1?Math.round((c[f+1]||0)*255):Math.round((c[f]||0)*255),t[l+2]=a>2?Math.round((c[f+2]||0)*255):Math.round((c[f]||0)*255),t[l+3]=n?Math.round((c[f+3]||1)*255):255;break}}}}}class Si{strategies=new Map;conversionPipeline;pendingConversions=new Map;constructor(e={}){this.conversionPipeline=new vi({maxConcurrent:e.maxConcurrent??2}),this.registerStrategy(new wi),this.registerStrategy(new Fi)}registerStrategy(e){e.getSupportedFormats().forEach(t=>{this.strategies.set(t,e)}),console.info(`Registered image converter strategy: ${e.getName()}`)}removeStrategy(e){let t=!1;const r=Array.from(this.strategies.values()).find(n=>n.getName()===e);return r&&(r.getSupportedFormats().forEach(n=>{this.strategies.get(n)===r&&(this.strategies.delete(n),t=!0)}),t&&console.info(`Removed image converter strategy: ${e}`)),t}getStrategies(){const e=new Set(this.strategies.values());return Array.from(e)}async findSuitableStrategy(e){try{const{fileTypeFromBlob:t}=await Pe(async()=>{const{fileTypeFromBlob:a}=await Promise.resolve().then(()=>gi);return{fileTypeFromBlob:a}},void 0),r=await t(e);if(!r)return console.info("Could not detect file type with file-type library"),null;console.info(`Detected file type: ${r.ext} (${r.mime})`);const n=this.strategies.get(r.mime);return n?await n.shouldConvert(e)?(console.info(`Found suitable conversion strategy: ${n.getName()}`),n):(console.info(`Strategy ${n.getName()} detected but conversion not needed`),null):(console.info(`No strategy found for MIME type: ${r.mime}`),null)}catch(t){return console.error("File type detection failed:",t),null}}async convertImage(e,t,r){const n=await this.findSuitableStrategy(e);if(!n)return console.info("No conversion strategy needed for this image"),null;console.info(`Converting image using ${n.getName()} strategy`);const a=this.getConversionTaskKey(n,t),s=r?.onLoadingStateUpdate,u=this.conversionPipeline.getActiveCount(),f=this.conversionPipeline.getMaxConcurrent(),l=u>=f,c=this.pendingConversions.get(a);if(c)return console.info(`Joining pending conversion task for ${n.getName()} (${t})`),await c;if(s&&l){const m=me.get(pe);s({isConverting:!0,isQueueWaiting:!0,conversionMessage:m.t("loading.queue.waiting")})}const o=this.conversionPipeline.enqueue(async()=>{try{return s?.({isQueueWaiting:!1,conversionMessage:void 0}),await n.convert(e,t,r)}finally{this.pendingConversions.delete(a)}});return this.pendingConversions.set(a,o),await o}getSupportedFormats(){return Array.from(this.strategies.keys())}getPipelineStats(){return{active:this.conversionPipeline.getActiveCount(),pending:this.conversionPipeline.getPendingCount()}}setMaxConcurrentConversions(e){this.conversionPipeline.setMaxConcurrent(e)}getConversionTaskKey(e,t){return`${e.getName()}::${t}`}}const zi=new Si;async function Bi(i,e={}){try{return await Ei(i,e)}catch(t){return console.error("Transmux error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown transmux error"}}}async function Ei(i,e={}){const{onProgress:t}=e;try{console.info(" Starting simple transmux conversion");const{t:r}=je();t?.({isConverting:!0,progress:10,message:r("video.conversion.transmux.fetching")});const n=await fetch(i);if(!n.ok)throw new Error(`Failed to fetch video: ${n.statusText}`);const a=await n.arrayBuffer();t?.({isConverting:!0,progress:30,message:r("video.conversion.transmux.analyzing")}),t?.({isConverting:!0,progress:60,message:r("video.conversion.transmux.converting")});const s=new Uint8Array(a);t?.({isConverting:!0,progress:80,message:r("video.conversion.transmux.creating")});const u=new Blob([s],{type:"video/mp4"}),f=URL.createObjectURL(u);return t?.({isConverting:!1,progress:100,message:r("video.conversion.transmux.success")}),{success:!0,videoUrl:f,convertedSize:u.size}}catch(r){return console.error("Simple transmux error:",r),{success:!1,error:r instanceof Error?r.message:"Simple transmux failed"}}}const le=new xe(10,(i,e,t)=>{if(i.videoUrl)try{URL.revokeObjectURL(i.videoUrl),console.info(`Video cache: Revoked blob URL - ${t}`)}catch(r){console.warn(`Failed to revoke video blob URL (${t}):`,r)}});function Mi(i,e){return new Promise(t=>{Bi(i,{onProgress:e}).then(r=>{t(r)}).catch(r=>{console.error("Transmux conversion failed:",r),t({success:!1,error:r instanceof Error?r.message:"Transmux failed"})})})}function Ti(){const e=document.createElement("video").canPlayType("video/quicktime");return he?!0:e==="probably"||e==="maybe"}function Ii(i){const e=i.toLowerCase();return e.includes(".mov")||e.endsWith(".mov")?Ti()?(console.info("Browser natively supports MOV format, skipping conversion"),!1):(console.info("Browser does not support MOV format, conversion needed"),!0):!1}async function Ai(i,e,t=!1){const{t:r}=je();if(t)console.info("Force reconversion: clearing cached result for",i),le.delete(i);else{const n=le.get(i);if(n)return console.info("Using cached video conversion result"),e?.({isConverting:!1,progress:100,message:r("video.conversion.cached.result")}),console.info("Cached video conversion result:",n),n}try{console.info(" Target format: MP4 (H.264)"),e?.({isConverting:!0,progress:0,message:r("video.conversion.transmux.high.quality")});const n=await Mi(i,e);return le.set(i,n),n.success?console.info("conversion completed successfully and cached"):console.error("conversion failed:",n.error),n}catch(n){return console.error("conversion failed:",n),{success:!1,error:`Conversion Failed: ${n instanceof Error?n.message:n}`}}}const Ue=new xe(10,(i,e,t)=>{try{URL.revokeObjectURL(i.blobSrc),console.info(`Regular image cache: Revoked blob URL - ${t}`)}catch(r){console.warn(`Failed to revoke regular image blob URL (${t}):`,r)}});class ji{currentXHR=null;delayTimer=null;async isValidImageBlob(e){if(e.size===0)return console.warn("Empty blob detected"),!1;try{const t=await Qe(e);return t?t.mime.startsWith("image/")?(console.info(`Valid image detected: ${t.ext} (${t.mime})`),!0):(console.warn(`Invalid file type detected: ${t.ext} (${t.mime})`),!1):(console.warn("Could not detect file type from blob"),!1)}catch(t){return console.error("Failed to detect file type:",t),!1}}async loadImage(e,t={}){const{onProgress:r,onError:n,onLoadingStateUpdate:a}=t;return a?.({isVisible:!0}),new Promise((s,u)=>{this.delayTimer=setTimeout(async()=>{const f=new XMLHttpRequest;f.open("GET",e),f.responseType="blob",f.onload=async()=>{if(f.status===200)try{const l=f.response;if(!await this.isValidImageBlob(l)){a?.({isVisible:!1}),n?.(),u(new Error("Response is not a valid image"));return}const c=await this.processImageBlob(l,e,t);s(c)}catch(l){a?.({isVisible:!1}),n?.(),u(l)}else a?.({isVisible:!1}),n?.(),u(new Error(`HTTP ${f.status}`))},f.onprogress=l=>{if(l.lengthComputable){const c=l.loaded/l.total*100;a?.({loadingProgress:c,loadedBytes:l.loaded,totalBytes:l.total}),r?.(c)}},f.onerror=()=>{a?.({isVisible:!1}),n?.(),u(new Error("Network error"))},f.send(),this.currentXHR=f},300)})}async processLivePhotoVideo(e,t,r={}){const{onLoadingStateUpdate:n}=r;return new Promise((a,s)=>{(async()=>{try{if(Ii(e)){const f=await this.convertVideo(e,t,r);a(f)}else{const f=await this.loadDirectVideo(e,t);a(f)}}catch(f){console.error("Failed to process Live Photo video:",f),n?.({isVisible:!1}),s(f)}})()})}async processImageBlob(e,t,r){const{onError:n,onLoadingStateUpdate:a}=r;try{const s=await zi.convertImage(e,t,r);return s?(console.info(`Image converted: ${(e.size/1024).toFixed(1)}KB  ${(s.convertedSize/1024).toFixed(1)}KB`),a?.({isVisible:!1}),{blobSrc:s.url,convertedUrl:s.url}):this.processRegularImage(e,t,r)}catch(s){console.error("Image conversion failed:",s);try{return console.info("Falling back to regular image processing"),this.processRegularImage(e,t,r)}catch(u){throw console.error("Fallback to regular image processing also failed:",u),a?.({isVisible:!1}),n?.(),s}}}processRegularImage(e,t,r){const{onLoadingStateUpdate:n}=r,a=t,s=Ue.get(a);if(s)return console.info("Using cached regular image result",s),n?.({isVisible:!1}),{blobSrc:s.blobSrc};const u=URL.createObjectURL(e),f={blobSrc:u,originalSize:e.size,format:e.type};return Ue.set(a,f),console.info(`Regular image processed and cached: ${(e.size/1024).toFixed(1)}KB, URL: ${t}`),n?.({isVisible:!1}),{blobSrc:u}}async convertVideo(e,t,r){const{onLoadingStateUpdate:n}=r;n?.({isVisible:!0,isConverting:!0,loadingProgress:0}),console.info("Converting MOV video to MP4...");const a=me.get(pe),s=await Ai(e,u=>{const l=[a.t("video.codec.keyword"),"encoder","codec",""].some(c=>u.message.toLowerCase().includes(c.toLowerCase()));n?.({isVisible:!0,isConverting:u.isConverting,loadingProgress:u.progress,conversionMessage:u.message,codecInfo:l?u.message:void 0})});if(s.success&&s.videoUrl){const u=s.videoUrl;return t.src=s.videoUrl,t.load(),console.info(`Video conversion completed. Size: ${s.convertedSize?Math.round(s.convertedSize/1024):"unknown"}KB`),n?.({isVisible:!1}),new Promise(f=>{const l=()=>{t.removeEventListener("canplaythrough",l),f({convertedVideoUrl:u})};t.addEventListener("canplaythrough",l)})}else throw console.error("Video conversion failed:",s.error),n?.({isVisible:!1}),new Error(s.error||"Video conversion failed")}async loadDirectVideo(e,t){return t.src=e,t.load(),new Promise(r=>{const n=()=>{t.removeEventListener("canplaythrough",n),r({conversionMethod:""})};t.addEventListener("canplaythrough",n)})}cleanup(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this.currentXHR&&(this.currentXHR.abort(),this.currentXHR=null)}}export{ji as I,Ui as g,Pi as i,Oi as u};
