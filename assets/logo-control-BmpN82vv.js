const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/maplibre-gl-BIFNluEs.js","vendor/1-CkNOVE2J.js"])))=>i.map(i=>d[i]);
import{r as a,d as I}from"../vendor/1-CkNOVE2J.js";import{aB as W}from"./index-87VEuC2R.js";var _=(t=>(t.North="N",t.South="S",t.East="E",t.West="W",t))(_||{});function G(t){if(!t?.GPSLatitude||!t?.GPSLongitude)return null;let e,n;try{typeof t.GPSLatitude=="number"?e=t.GPSLatitude:e=Number(t.GPSLatitude),typeof t.GPSLongitude=="number"?n=t.GPSLongitude:n=Number(t.GPSLongitude);const i=t.GPSLatitudeRef==="S"||t.GPSLatitudeRef==="South"?_.South:_.North,r=t.GPSLongitudeRef==="W"||t.GPSLongitudeRef==="West"?_.West:_.East;i===_.South&&e>0&&(e=-e),r===_.West&&n>0&&(n=-n);let o,s;return t.GPSAltitude&&typeof t.GPSAltitude=="number"&&(o=t.GPSAltitude,s=t.GPSAltitudeRef==="Below Sea Level"?"Below Sea Level":"Above Sea Level",s==="Below Sea Level"&&(o=-o)),H({latitude:e,longitude:n})?{latitude:e,longitude:n,latitudeRef:i,longitudeRef:r,altitude:o,altitudeRef:s}:null}catch(i){return console.warn("Failed to parse GPS coordinates from EXIF:",i),null}}function H(t){if(!t)return!1;const{latitude:e,longitude:n}=t;return typeof e=="number"&&typeof n=="number"&&!Number.isNaN(e)&&!Number.isNaN(n)&&e>=-90&&e<=90&&n>=-180&&n<=180}function V(t){const{exif:e}=t;if(!e)return null;const n=G(e);if(!n)return null;const{latitude:i,longitude:r,latitudeRef:o,longitudeRef:s,altitude:u,altitudeRef:l}=n;return{id:t.id,longitude:r,latitude:i,altitude:u,latitudeRef:o,longitudeRef:s,altitudeRef:l,photo:t}}function dt(t){return t.map(e=>V(e)).filter(e=>e!==null)}function Z(t){if(t.length===0)return null;const e=t.map(u=>u.latitude),n=t.map(u=>u.longitude),i=Math.min(...e),r=Math.max(...e),o=Math.min(...n),s=Math.max(...n);return{minLat:i,maxLat:r,minLng:o,maxLng:s,centerLat:(i+r)/2,centerLng:(o+s)/2,bounds:[[o,i],[s,r]]}}function ft(t){const e=Z(t);if(!e)return{longitude:-122.4,latitude:37.8,zoom:10};const n=e.maxLat-e.minLat,i=e.maxLng-e.minLng,r=Math.max(n,i);let o=10;return r<.01?o=15:r<.1?o=12:r<1?o=8:r<10?o=5:o=2,{longitude:e.centerLng,latitude:e.centerLat,zoom:o}}const F=a.createContext(null);function mt(){const t=a.useContext(F)?.maps,e=a.useContext(E);return a.useMemo(()=>({...t,current:e?.map}),[t,e])}function j(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===o}function g(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!g(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!g(t[r],e[r]))return!1;return!0}return!1}function b(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function R(t,e){const n=e.viewState||e,i={};if("longitude"in n&&"latitude"in n&&(n.longitude!==t.center.lng||n.latitude!==t.center.lat)){const r=t.center.constructor;i.center=new r(n.longitude,n.latitude)}return"zoom"in n&&n.zoom!==t.zoom&&(i.zoom=n.zoom),"bearing"in n&&n.bearing!==t.bearing&&(i.bearing=n.bearing),"pitch"in n&&n.pitch!==t.pitch&&(i.pitch=n.pitch),n.padding&&t.padding&&!g(n.padding,t.padding)&&(i.padding=n.padding),i}const B=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function x(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const o=e[i.ref];if(o){r=r||Object.assign({},i),delete r.ref;for(const s of B)s in o&&(r[s]=o[s])}return r||i});return{...t,layers:n}}const T={version:8,sources:{},layers:[]},N={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},z={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},k={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},q=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],X=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class C{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=r=>{const o=this.props[k[r.type]];o?o(r):r.type==="error"&&console.error(r.error)},this._onCameraEvent=r=>{if(this._internalUpdate)return;r.viewState=this._propsedCameraUpdate||b(this._map.transform);const o=this.props[z[r.type]];o&&o(r)},this._onCameraUpdate=r=>this._internalUpdate?r:(this._propsedCameraUpdate=b(r),R(r,this.props)),this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const o=this.props[N[r.type]];o&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),o(r),delete r.features)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n),r=this._updateSize(e),o=this._updateViewState(e);this._updateStyle(e,n),this._updateStyleComponents(e),this._updateHandlers(e,n),(i||r||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=C.savedMaps.pop();if(!i)return null;const r=i.map,o=r.getContainer();for(n.className=o.className;o.childNodes.length>0;)n.appendChild(o.childNodes[0]);r._container=n;const s=r._resizeObserver;s&&(s.disconnect(),s.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:u}=e;return u&&(u.bounds?r.fitBounds(u.bounds,{...u.fitBoundsOptions,duration:0}):i._updateViewState(u)),r.isStyleLoaded()?r.fire("load"):r.once("style.load",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=T}=n,r={...n,...n.initialViewState,container:e,style:x(i)},o=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const s=new this._MapClass(r);o.padding&&s.setPadding(o.padding),n.cursor&&(s.getCanvas().style.cursor=n.cursor),s.transformCameraUpdate=this._onCameraUpdate,s.on("style.load",()=>{this._styleComponents={light:s.getLight(),sky:s.getSky(),projection:s.getProjection?.(),terrain:s.getTerrain()},this._updateStyleComponents(this.props)}),s.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const u in N)s.on(u,this._onPointerEvent);for(const u in z)s.on(u,this._onCameraEvent);for(const u in k)s.on(u,this._onEvent);this._map=s}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),C.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e){const n=this._map,i=n.transform;if(!n.isMoving()){const o=R(i,e);if(Object.keys(o).length>0)return this._internalUpdate=!0,n.jumpTo(o),this._internalUpdate=!1,!0}return!1}_updateSettings(e,n){const i=this._map;let r=!1;for(const o of q)o in e&&!g(e[o],n[o])&&(r=!0,i[`set${o[0].toUpperCase()}${o.slice(1)}`]?.call(i,e[o]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=T,styleDiffing:r=!0}=e,o={diff:r};"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(x(i),o)}}_updateStyleComponents({light:e,projection:n,sky:i,terrain:r}){const o=this._map,s=this._styleComponents;o.style._loaded&&(e&&!g(e,s.light)&&(s.light=e,o.setLight(e)),n&&!g(n,s.projection)&&n!==s.projection?.type&&(s.projection=typeof n=="string"?{type:n}:n,o.setProjection?.(s.projection)),i&&!g(i,s.sky)&&(s.sky=i,o.setSky(i)),r!==void 0&&!g(r,s.terrain)&&(!r||o.getSource(r.source))&&(s.terrain=r,o.setTerrain(r)))}_updateHandlers(e,n){const i=this._map;for(const r of X){const o=e[r]??!0,s=n[r]??!0;g(o,s)||(o?i[r].enable(o):i[r].disable())}}_queryRenderedFeatures(e){const n=this._map,{interactiveLayerIds:i=[]}=this.props;try{return n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}}_updateHover(e){const{props:n}=this;if(n.interactiveLayerIds&&(n.onMouseMove||n.onMouseEnter||n.onMouseLeave)){const r=e.type,o=this._hoveredFeatures?.length>0,s=this._queryRenderedFeatures(e.point),u=s.length>0;!u&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=s,u&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=r}else this._hoveredFeatures=null}}C.savedMaps=[];const $=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function J(t){if(!t)return null;const e=t.map,n={getMap:()=>e};for(const i of K(e))!(i in n)&&!$.includes(i)&&(n[i]=e[i].bind(e));return n}function K(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const Y=typeof document<"u"?a.useLayoutEffect:a.useEffect;function Q(t,e){const{RTLTextPlugin:n,maxParallelImageRequests:i,workerCount:r,workerUrl:o}=e;if(n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:s,lazy:u=!0}=typeof n=="string"?{pluginUrl:n}:n;t.setRTLTextPlugin(s,l=>{l&&console.error(l)},u)}i!==void 0&&t.setMaxParallelImageRequests(i),r!==void 0&&t.setWorkerCount(r),o!==void 0&&t.setWorkerUrl(o)}const E=a.createContext(null);function tt(t,e){const n=a.useContext(F),[i,r]=a.useState(null),o=a.useRef(),{current:s}=a.useRef({mapLib:null,map:null});a.useEffect(()=>{const c=t.mapLib;let S=!0,f;return Promise.resolve(c||W(()=>import("./maplibre-gl-BIFNluEs.js").then(d=>d.m),__vite__mapDeps([0,1]))).then(d=>{if(!S)return;if(!d)throw new Error("Invalid mapLib");const m="Map"in d?d:d.default;if(!m.Map)throw new Error("Invalid mapLib");Q(m,t),t.reuseMaps&&(f=C.reuse(t,o.current)),f||(f=new C(m.Map,t,o.current)),s.map=J(f),s.mapLib=m,r(f),n?.onMapMount(s.map,t.id)}).catch(d=>{const{onError:m}=t;m?m({type:"error",target:null,originalEvent:null,error:d}):console.error(d)}),()=>{S=!1,f&&(n?.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),Y(()=>{i&&i.setProps(t)}),a.useImperativeHandle(e,()=>s.map,[i]);const u=a.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),l={height:"100%"};return a.createElement("div",{id:t.id,ref:o,style:u},i&&a.createElement(E.Provider,{value:s},a.createElement("div",{"mapboxgl-children":"",style:l},t.children)))}const gt=a.forwardRef(tt),et=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function p(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!et.test(i)?n[i]=`${r}px`:n[i]=r}}function O(t,e){if(t===e)return null;const n=A(t),i=A(e),r=[];for(const o of i)n.has(o)||r.push(o);for(const o of n)i.has(o)||r.push(o);return r.length===0?null:r}function A(t){return new Set(t?t.trim().split(/\s+/):[])}const ht=a.memo(a.forwardRef((t,e)=>{const{map:n,mapLib:i}=a.useContext(E),r=a.useRef({props:t}),o=a.useMemo(()=>{let M=!1;a.Children.forEach(t.children,h=>{h&&(M=!0)});const D={...t,element:M?document.createElement("div"):void 0},v=new i.Marker(D);return v.setLngLat([t.longitude,t.latitude]),v.getElement().addEventListener("click",h=>{r.current.props.onClick?.({type:"click",target:v,originalEvent:h})}),v.on("dragstart",h=>{const y=h;y.lngLat=o.getLngLat(),r.current.props.onDragStart?.(y)}),v.on("drag",h=>{const y=h;y.lngLat=o.getLngLat(),r.current.props.onDrag?.(y)}),v.on("dragend",h=>{const y=h;y.lngLat=o.getLngLat(),r.current.props.onDragEnd?.(y)}),v},[]);a.useEffect(()=>(o.addTo(n.getMap()),()=>{o.remove()}),[]);const{longitude:s,latitude:u,offset:l,style:c,draggable:S=!1,popup:f=null,rotation:d=0,rotationAlignment:m="auto",pitchAlignment:P="auto"}=t;a.useEffect(()=>{p(o.getElement(),c)},[c]),a.useImperativeHandle(e,()=>o,[]);const U=r.current.props;(o.getLngLat().lng!==s||o.getLngLat().lat!==u)&&o.setLngLat([s,u]),l&&!j(o.getOffset(),l)&&o.setOffset(l),o.isDraggable()!==S&&o.setDraggable(S),o.getRotation()!==d&&o.setRotation(d),o.getRotationAlignment()!==m&&o.setRotationAlignment(m),o.getPitchAlignment()!==P&&o.setPitchAlignment(P),o.getPopup()!==f&&o.setPopup(f);const w=O(U.className,t.className);if(w)for(const M of w)o.toggleClassName(M);return r.current.props=t,I.createPortal(t.children,o.getElement())}));a.memo(a.forwardRef((t,e)=>{const{map:n,mapLib:i}=a.useContext(E),r=a.useMemo(()=>document.createElement("div"),[]),o=a.useRef({props:t}),s=a.useMemo(()=>{const u={...t},l=new i.Popup(u);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{o.current.props.onOpen?.(c)}),l},[]);if(a.useEffect(()=>{const u=l=>{o.current.props.onClose?.(l)};return s.on("close",u),s.setDOMContent(r).addTo(n.getMap()),()=>{s.off("close",u),s.isOpen()&&s.remove()}},[]),a.useEffect(()=>{p(s.getElement(),t.style)},[t.style]),a.useImperativeHandle(e,()=>s,[]),s.isOpen()){const u=o.current.props;(s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!g(u.offset,t.offset)&&s.setOffset(t.offset),(u.anchor!==t.anchor||u.maxWidth!==t.maxWidth)&&(s.options.anchor=t.anchor,s.setMaxWidth(t.maxWidth));const l=O(u.className,t.className);if(l)for(const c of l)s.toggleClassName(c);o.current.props=t}return I.createPortal(t.children,r)}));function L(t,e,n,i){const r=a.useContext(E),o=a.useMemo(()=>t(r),[]);return a.useEffect(()=>{const s=e,u=null,l=typeof e=="function"?e:null,{map:c}=r;return c.hasControl(o)||(c.addControl(o,s?.position),u&&u(r)),()=>{l&&l(r),c.hasControl(o)&&c.removeControl(o)}},[]),o}function nt(t){const e=L(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return a.useEffect(()=>{p(e._container,t.style)},[t.style]),null}a.memo(nt);function ot(t){const e=L(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return a.useEffect(()=>{p(e._controlContainer,t.style)},[t.style]),null}a.memo(ot);function rt(t,e){const n=a.useRef({props:t}),i=L(({mapLib:r})=>{const o=new r.GeolocateControl(t),s=o._setupUI;return o._setupUI=()=>{o._container.hasChildNodes()||s()},o.on("geolocate",u=>{n.current.props.onGeolocate?.(u)}),o.on("error",u=>{n.current.props.onError?.(u)}),o.on("outofmaxbounds",u=>{n.current.props.onOutOfMaxBounds?.(u)}),o.on("trackuserlocationstart",u=>{n.current.props.onTrackUserLocationStart?.(u)}),o.on("trackuserlocationend",u=>{n.current.props.onTrackUserLocationEnd?.(u)}),o},{position:t.position});return n.current.props=t,a.useImperativeHandle(e,()=>i,[]),a.useEffect(()=>{p(i._container,t.style)},[t.style]),null}a.memo(a.forwardRef(rt));function it(t){const e=L(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return a.useEffect(()=>{p(e._container,t.style)},[t.style]),null}a.memo(it);function st(t){const e=L(({mapLib:o})=>new o.ScaleControl(t),{position:t.position}),n=a.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),a.useEffect(()=>{p(e._container,r)},[r]),null}a.memo(st);function at(t){const e=L(({mapLib:n})=>new n.TerrainControl(t),{position:t.position});return a.useEffect(()=>{p(e._container,t.style)},[t.style]),null}a.memo(at);function ut(t){const e=L(({mapLib:n})=>new n.LogoControl(t),{position:t.position});return a.useEffect(()=>{p(e._container,t.style)},[t.style]),null}a.memo(ut);export{gt as M,Z as a,dt as b,G as c,E as d,g as e,ht as f,ft as g,mt as u};
