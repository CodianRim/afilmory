const J={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tt={};for(const i in J)tt[J[i]]=Number(i);const kt=Object.freeze(Object.defineProperty({__proto__:null,tagsById:J,tagsByName:tt},Symbol.toStringTag,{value:"Module"})),Q={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},it={};for(const i in Q)it[Q[i]]=Number(i);const Et=Object.freeze(Object.defineProperty({__proto__:null,tagsById:Q,tagsByName:it},Symbol.toStringTag,{value:"Module"})),q={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},nt={};for(const i in q)nt[q[i]]=Number(i);const It=Object.freeze(Object.defineProperty({__proto__:null,tagsById:q,tagsByName:nt},Symbol.toStringTag,{value:"Module"}));function we(i,t="utf8"){return new TextDecoder(t).decode(i)}const Dt=new TextEncoder;function At(i){return Dt.encode(i)}const Pt=1024*8,vt=(()=>{const i=new Uint8Array(4),t=new Uint32Array(i.buffer);return!((t[0]=1)&i[0])})(),ae={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class te{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(t=Pt,e={}){let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const o=e.offset?e.offset>>>0:0,a=t.byteLength-o;let c=o;(ArrayBuffer.isView(t)||t instanceof te)&&(t.byteLength!==t.buffer.byteLength&&(c=t.byteOffset+o),t=t.buffer),n?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=c,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,c,a),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const n=ae[e].BYTES_PER_ELEMENT*t,o=this.byteOffset+this.offset,a=this.buffer.slice(o,o+n);if(this.littleEndian===vt&&e!=="uint8"&&e!=="int8"){const l=new Uint8Array(this.buffer.slice(o,o+n));l.reverse();const p=new ae[e](l.buffer);return this.offset+=n,p.reverse(),p}const c=new ae[e](a);return this.offset+=n,c}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(t=1){return we(this.readBytes(t))}decodeText(t=1,e="utf8"){return we(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(At(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Tt(i){if(i.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const t=i.rowsPerStrip*i.width*i.samplesPerPixel*(i.bitsPerSample/8);return new Array(i.stripOffsets.length).fill(t)}function Ct(i,t,e){let n=0;for(;n<i.length;){for(let o=e;o<t*e;o+=e)for(let a=0;a<e;a++)i[n+o+a]=i[n+o+a]+i[n+o-(e-a)]&255;n+=t*e}}function Bt(i,t,e){let n=0;for(;n<i.length;){for(let o=e;o<t*e;o+=e)for(let a=0;a<e;a++)i[n+o+a]=i[n+o+a]+i[n+o-(e-a)]&65535;n+=t*e}}const pe={standard:It,exif:kt,gps:Et};class at{kind;data;fields;exif;gps;_hasMap;_map;constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if(typeof t=="number")return this.fields.get(t);if(typeof t=="string")return this.fields.get(pe[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=pe[this.kind].tagsById;for(const e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}const rt=new Map([[1,[1,me]],[2,[1,Mt]],[3,[2,Ft]],[4,[4,Ut]],[5,[8,Ot]],[6,[1,Nt]],[7,[1,me]],[8,[2,Gt]],[9,[4,$t]],[10,[8,zt]],[11,[4,Ht]],[12,[8,Zt]]]);function Lt(i,t){const e=rt.get(i);if(!e)throw new Error(`type not found: ${i}`);return e[0]*t}function Rt(i,t,e){const n=rt.get(t);if(!n)throw new Error(`type not found: ${t}`);return n[1](i,e)}function me(i,t){if(t===1)return i.readUint8();const e=new Uint8Array(t);for(let n=0;n<t;n++)e[n]=i.readUint8();return e}function Mt(i,t){const e=[];let n="";for(let o=0;o<t;o++){const a=String.fromCharCode(i.readUint8());a==="\0"?(e.push(n),n=""):n+=a}return e.length===1?e[0]:e}function Ft(i,t){if(t===1)return i.readUint16();const e=new Uint16Array(t);for(let n=0;n<t;n++)e[n]=i.readUint16();return e}function Ut(i,t){if(t===1)return i.readUint32();const e=new Uint32Array(t);for(let n=0;n<t;n++)e[n]=i.readUint32();return e}function Ot(i,t){if(t===1)return i.readUint32()/i.readUint32();const e=new Array(t);for(let n=0;n<t;n++)e[n]=i.readUint32()/i.readUint32();return e}function Nt(i,t){if(t===1)return i.readInt8();const e=new Int8Array(t);for(let n=0;n<t;n++)e[n]=i.readInt8();return e}function Gt(i,t){if(t===1)return i.readInt16();const e=new Int16Array(t);for(let n=0;n<t;n++)e[n]=i.readInt16();return e}function $t(i,t){if(t===1)return i.readInt32();const e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=i.readInt32();return e}function zt(i,t){if(t===1)return i.readInt32()/i.readInt32();const e=new Array(t);for(let n=0;n<t;n++)e[n]=i.readInt32()/i.readInt32();return e}function Ht(i,t){if(t===1)return i.readFloat32();const e=new Float32Array(t);for(let n=0;n<t;n++)e[n]=i.readFloat32();return e}function Zt(i,t){if(t===1)return i.readFloat64();const e=new Float64Array(t);for(let n=0;n<t;n++)e[n]=i.readFloat64();return e}const Wt=256,ye=257,_e=258,Se=9;let M=[];function Vt(){if(M.length===0){for(let t=0;t<256;t++)M.push([t]);const i=[];for(let t=256;t<4096;t++)M.push(i)}}const jt=[511,1023,2047,4095],Yt=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class Xt{stripArray;nextData=0;nextBits=0;bytePointer=0;tableLength=_e;currentBitLength=Se;outData;constructor(t){this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.outData=new te(t.byteLength),this.initializeTable()}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==ye;)if(t===Wt){if(this.initializeTable(),t=this.getNextCode(),t===ye)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const o=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(o),this.addStringToTable(o),e=t}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){Vt(),this.tableLength=_e,this.currentBitLength=Se}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return M[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){if(M[this.tableLength++]=t,M.length>4096)throw M=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===Yt[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const t=this.nextData>>this.nextBits-this.currentBitLength&jt[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:t}}function Kt(i){return new Xt(i).decode()}const Jt=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class ke extends at{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){const t=new Date,e=Jt.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&typeof t!="number"?t[0]:t}get alpha(){const t=this.extraSamples;return t?t[0]!==0:!1}get associatedAlpha(){const t=this.extraSamples;return t?t[0]===1:!1}get extraSamples(){return O(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return O(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")||2**32-1}get stripByteCounts(){return O(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||2**this.bitsPerSample-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return O(this.get("SampleFormat")||1)[0]}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error(`ColorMap size must be ${t}`);const n=[];for(let o=0;o<t;o++)n.push([e[o],e[o+t],e[o+2*t]]);return n}get tileWidth(){return this.get("TileWidth")}get tileHeight(){return this.get("TileLength")}get tileOffsets(){return O(this.get("TileOffsets"))}get tileByteCounts(){return O(this.get("TileByteCounts"))}get tiled(){return this.tileWidth!==void 0&&this.tileHeight!==void 0&&this.tileOffsets!==void 0&&this.tileByteCounts!==void 0}}function O(i){return typeof i=="number"?[i]:i}function $(i){let t=i.length;for(;--t>=0;)i[t]=0}const Qt=3,qt=258,st=29,ei=256,ti=ei+1+st,ot=30,ii=512,ni=new Array((ti+2)*2);$(ni);const ai=new Array(ot*2);$(ai);const ri=new Array(ii);$(ri);const si=new Array(qt-Qt+1);$(si);const oi=new Array(st);$(oi);const li=new Array(ot);$(li);const fi=(i,t,e,n)=>{let o=i&65535|0,a=i>>>16&65535|0,c=0;for(;e!==0;){c=e>2e3?2e3:e,e-=c;do o=o+t[n++]|0,a=a+o|0;while(--c);o%=65521,a%=65521}return o|a<<16|0};var de=fi;const hi=()=>{let i,t=[];for(var e=0;e<256;e++){i=e;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;t[e]=i}return t},ci=new Uint32Array(hi()),ui=(i,t,e,n)=>{const o=ci,a=n+e;i^=-1;for(let c=n;c<a;c++)i=i>>>8^o[(i^t[c])&255];return i^-1};var T=ui,xe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},lt={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const di=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);var xi=function(i){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)di(e,n)&&(i[n]=e[n])}}return i},gi=i=>{let t=0;for(let n=0,o=i.length;n<o;n++)t+=i[n].length;const e=new Uint8Array(t);for(let n=0,o=0,a=i.length;n<a;n++){let c=i[n];e.set(c,o),o+=c.length}return e},ft={assign:xi,flattenChunks:gi};let ht=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ht=!1}const H=new Uint8Array(256);for(let i=0;i<256;i++)H[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;H[254]=H[254]=1;var bi=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let t,e,n,o,a,c=i.length,l=0;for(o=0;o<c;o++)e=i.charCodeAt(o),(e&64512)===55296&&o+1<c&&(n=i.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(l),a=0,o=0;a<l;o++)e=i.charCodeAt(o),(e&64512)===55296&&o+1<c&&(n=i.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|e&63):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|e&63):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|e&63);return t};const wi=(i,t)=>{if(t<65534&&i.subarray&&ht)return String.fromCharCode.apply(null,i.length===t?i:i.subarray(0,t));let e="";for(let n=0;n<t;n++)e+=String.fromCharCode(i[n]);return e};var pi=(i,t)=>{const e=t||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,t));let n,o;const a=new Array(e*2);for(o=0,n=0;n<e;){let c=i[n++];if(c<128){a[o++]=c;continue}let l=H[c];if(l>4){a[o++]=65533,n+=l-1;continue}for(c&=l===2?31:l===3?15:7;l>1&&n<e;)c=c<<6|i[n++]&63,l--;if(l>1){a[o++]=65533;continue}c<65536?a[o++]=c:(c-=65536,a[o++]=55296|c>>10&1023,a[o++]=56320|c&1023)}return wi(a,o)},mi=(i,t)=>{t=t||i.length,t>i.length&&(t=i.length);let e=t-1;for(;e>=0&&(i[e]&192)===128;)e--;return e<0||e===0?t:e+H[i[e]]>t?e:t},ge={string2buf:bi,buf2string:pi,utf8border:mi};function yi(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var _i=yi;const j=16209,Si=16191;var ki=function(t,e){let n,o,a,c,l,p,r,s,E,d,f,x,D,m,b,k,w,h,y,P,u,I,_,g;const S=t.state;n=t.next_in,_=t.input,o=n+(t.avail_in-5),a=t.next_out,g=t.output,c=a-(e-t.avail_out),l=a+(t.avail_out-257),p=S.dmax,r=S.wsize,s=S.whave,E=S.wnext,d=S.window,f=S.hold,x=S.bits,D=S.lencode,m=S.distcode,b=(1<<S.lenbits)-1,k=(1<<S.distbits)-1;e:do{x<15&&(f+=_[n++]<<x,x+=8,f+=_[n++]<<x,x+=8),w=D[f&b];t:for(;;){if(h=w>>>24,f>>>=h,x-=h,h=w>>>16&255,h===0)g[a++]=w&65535;else if(h&16){y=w&65535,h&=15,h&&(x<h&&(f+=_[n++]<<x,x+=8),y+=f&(1<<h)-1,f>>>=h,x-=h),x<15&&(f+=_[n++]<<x,x+=8,f+=_[n++]<<x,x+=8),w=m[f&k];i:for(;;){if(h=w>>>24,f>>>=h,x-=h,h=w>>>16&255,h&16){if(P=w&65535,h&=15,x<h&&(f+=_[n++]<<x,x+=8,x<h&&(f+=_[n++]<<x,x+=8)),P+=f&(1<<h)-1,P>p){t.msg="invalid distance too far back",S.mode=j;break e}if(f>>>=h,x-=h,h=a-c,P>h){if(h=P-h,h>s&&S.sane){t.msg="invalid distance too far back",S.mode=j;break e}if(u=0,I=d,E===0){if(u+=r-h,h<y){y-=h;do g[a++]=d[u++];while(--h);u=a-P,I=g}}else if(E<h){if(u+=r+E-h,h-=E,h<y){y-=h;do g[a++]=d[u++];while(--h);if(u=0,E<y){h=E,y-=h;do g[a++]=d[u++];while(--h);u=a-P,I=g}}}else if(u+=E-h,h<y){y-=h;do g[a++]=d[u++];while(--h);u=a-P,I=g}for(;y>2;)g[a++]=I[u++],g[a++]=I[u++],g[a++]=I[u++],y-=3;y&&(g[a++]=I[u++],y>1&&(g[a++]=I[u++]))}else{u=a-P;do g[a++]=g[u++],g[a++]=g[u++],g[a++]=g[u++],y-=3;while(y>2);y&&(g[a++]=g[u++],y>1&&(g[a++]=g[u++]))}}else if((h&64)===0){w=m[(w&65535)+(f&(1<<h)-1)];continue i}else{t.msg="invalid distance code",S.mode=j;break e}break}}else if((h&64)===0){w=D[(w&65535)+(f&(1<<h)-1)];continue t}else if(h&32){S.mode=Si;break e}else{t.msg="invalid literal/length code",S.mode=j;break e}break}}while(n<o&&a<l);y=x>>3,n-=y,x-=y<<3,f&=(1<<x)-1,t.next_in=n,t.next_out=a,t.avail_in=n<o?5+(o-n):5-(n-o),t.avail_out=a<l?257+(l-a):257-(a-l),S.hold=f,S.bits=x};const N=15,Ee=852,Ie=592,De=0,re=1,Ae=2,Ei=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ii=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Di=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ai=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Pi=(i,t,e,n,o,a,c,l)=>{const p=l.bits;let r=0,s=0,E=0,d=0,f=0,x=0,D=0,m=0,b=0,k=0,w,h,y,P,u,I=null,_;const g=new Uint16Array(N+1),S=new Uint16Array(N+1);let R=null,be,W,V;for(r=0;r<=N;r++)g[r]=0;for(s=0;s<n;s++)g[t[e+s]]++;for(f=p,d=N;d>=1&&g[d]===0;d--);if(f>d&&(f=d),d===0)return o[a++]=1<<24|64<<16|0,o[a++]=1<<24|64<<16|0,l.bits=1,0;for(E=1;E<d&&g[E]===0;E++);for(f<E&&(f=E),m=1,r=1;r<=N;r++)if(m<<=1,m-=g[r],m<0)return-1;if(m>0&&(i===De||d!==1))return-1;for(S[1]=0,r=1;r<N;r++)S[r+1]=S[r]+g[r];for(s=0;s<n;s++)t[e+s]!==0&&(c[S[t[e+s]]++]=s);if(i===De?(I=R=c,_=20):i===re?(I=Ei,R=Ii,_=257):(I=Di,R=Ai,_=0),k=0,s=0,r=E,u=a,x=f,D=0,y=-1,b=1<<f,P=b-1,i===re&&b>Ee||i===Ae&&b>Ie)return 1;for(;;){be=r-D,c[s]+1<_?(W=0,V=c[s]):c[s]>=_?(W=R[c[s]-_],V=I[c[s]-_]):(W=96,V=0),w=1<<r-D,h=1<<x,E=h;do h-=w,o[u+(k>>D)+h]=be<<24|W<<16|V|0;while(h!==0);for(w=1<<r-1;k&w;)w>>=1;if(w!==0?(k&=w-1,k+=w):k=0,s++,--g[r]===0){if(r===d)break;r=t[e+c[s]]}if(r>f&&(k&P)!==y){for(D===0&&(D=f),u+=E,x=r-D,m=1<<x;x+D<d&&(m-=g[x+D],!(m<=0));)x++,m<<=1;if(b+=1<<x,i===re&&b>Ee||i===Ae&&b>Ie)return 1;y=k&P,o[y]=f<<24|x<<16|u-a|0}}return k!==0&&(o[u+k]=r-D<<24|64<<16|0),l.bits=f,0};var z=Pi;const vi=0,ct=1,ut=2,{Z_FINISH:Pe,Z_BLOCK:Ti,Z_TREES:Y,Z_OK:F,Z_STREAM_END:Ci,Z_NEED_DICT:Bi,Z_STREAM_ERROR:v,Z_DATA_ERROR:dt,Z_MEM_ERROR:xt,Z_BUF_ERROR:Li,Z_DEFLATED:ve}=lt,ie=16180,Te=16181,Ce=16182,Be=16183,Le=16184,Re=16185,Me=16186,Fe=16187,Ue=16188,Oe=16189,ee=16190,C=16191,se=16192,Ne=16193,oe=16194,Ge=16195,$e=16196,ze=16197,He=16198,X=16199,K=16200,Ze=16201,We=16202,Ve=16203,je=16204,Ye=16205,le=16206,Xe=16207,Ke=16208,A=16209,gt=16210,bt=16211,Ri=852,Mi=592,Fi=15,Ui=Fi,Je=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function Oi(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const U=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.mode<ie||t.mode>bt?1:0},wt=i=>{if(U(i))return v;const t=i.state;return i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=t.wrap&1),t.mode=ie,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(Ri),t.distcode=t.distdyn=new Int32Array(Mi),t.sane=1,t.back=-1,F},pt=i=>{if(U(i))return v;const t=i.state;return t.wsize=0,t.whave=0,t.wnext=0,wt(i)},mt=(i,t)=>{let e;if(U(i))return v;const n=i.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?v:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=e,n.wbits=t,pt(i))},yt=(i,t)=>{if(!i)return v;const e=new Oi;i.state=e,e.strm=i,e.window=null,e.mode=ie;const n=mt(i,t);return n!==F&&(i.state=null),n},Ni=i=>yt(i,Ui);let Qe=!0,fe,he;const Gi=i=>{if(Qe){fe=new Int32Array(512),he=new Int32Array(32);let t=0;for(;t<144;)i.lens[t++]=8;for(;t<256;)i.lens[t++]=9;for(;t<280;)i.lens[t++]=7;for(;t<288;)i.lens[t++]=8;for(z(ct,i.lens,0,288,fe,0,i.work,{bits:9}),t=0;t<32;)i.lens[t++]=5;z(ut,i.lens,0,32,he,0,i.work,{bits:5}),Qe=!1}i.lencode=fe,i.lenbits=9,i.distcode=he,i.distbits=5},_t=(i,t,e,n)=>{let o;const a=i.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>n&&(o=n),a.window.set(t.subarray(e-n,e-n+o),a.wnext),n-=o,n?(a.window.set(t.subarray(e-n,e),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0},$i=(i,t)=>{let e,n,o,a,c,l,p,r,s,E,d,f,x,D,m=0,b,k,w,h,y,P,u,I;const _=new Uint8Array(4);let g,S;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(U(i)||!i.output||!i.input&&i.avail_in!==0)return v;e=i.state,e.mode===C&&(e.mode=se),c=i.next_out,o=i.output,p=i.avail_out,a=i.next_in,n=i.input,l=i.avail_in,r=e.hold,s=e.bits,E=l,d=p,I=F;e:for(;;)switch(e.mode){case ie:if(e.wrap===0){e.mode=se;break}for(;s<16;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(e.wrap&2&&r===35615){e.wbits===0&&(e.wbits=15),e.check=0,_[0]=r&255,_[1]=r>>>8&255,e.check=T(e.check,_,2,0),r=0,s=0,e.mode=Te;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((r&255)<<8)+(r>>8))%31){i.msg="incorrect header check",e.mode=A;break}if((r&15)!==ve){i.msg="unknown compression method",e.mode=A;break}if(r>>>=4,s-=4,u=(r&15)+8,e.wbits===0&&(e.wbits=u),u>15||u>e.wbits){i.msg="invalid window size",e.mode=A;break}e.dmax=1<<e.wbits,e.flags=0,i.adler=e.check=1,e.mode=r&512?Oe:C,r=0,s=0;break;case Te:for(;s<16;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(e.flags=r,(e.flags&255)!==ve){i.msg="unknown compression method",e.mode=A;break}if(e.flags&57344){i.msg="unknown header flags set",e.mode=A;break}e.head&&(e.head.text=r>>8&1),e.flags&512&&e.wrap&4&&(_[0]=r&255,_[1]=r>>>8&255,e.check=T(e.check,_,2,0)),r=0,s=0,e.mode=Ce;case Ce:for(;s<32;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}e.head&&(e.head.time=r),e.flags&512&&e.wrap&4&&(_[0]=r&255,_[1]=r>>>8&255,_[2]=r>>>16&255,_[3]=r>>>24&255,e.check=T(e.check,_,4,0)),r=0,s=0,e.mode=Be;case Be:for(;s<16;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}e.head&&(e.head.xflags=r&255,e.head.os=r>>8),e.flags&512&&e.wrap&4&&(_[0]=r&255,_[1]=r>>>8&255,e.check=T(e.check,_,2,0)),r=0,s=0,e.mode=Le;case Le:if(e.flags&1024){for(;s<16;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}e.length=r,e.head&&(e.head.extra_len=r),e.flags&512&&e.wrap&4&&(_[0]=r&255,_[1]=r>>>8&255,e.check=T(e.check,_,2,0)),r=0,s=0}else e.head&&(e.head.extra=null);e.mode=Re;case Re:if(e.flags&1024&&(f=e.length,f>l&&(f=l),f&&(e.head&&(u=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(a,a+f),u)),e.flags&512&&e.wrap&4&&(e.check=T(e.check,n,f,a)),l-=f,a+=f,e.length-=f),e.length))break e;e.length=0,e.mode=Me;case Me:if(e.flags&2048){if(l===0)break e;f=0;do u=n[a+f++],e.head&&u&&e.length<65536&&(e.head.name+=String.fromCharCode(u));while(u&&f<l);if(e.flags&512&&e.wrap&4&&(e.check=T(e.check,n,f,a)),l-=f,a+=f,u)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Fe;case Fe:if(e.flags&4096){if(l===0)break e;f=0;do u=n[a+f++],e.head&&u&&e.length<65536&&(e.head.comment+=String.fromCharCode(u));while(u&&f<l);if(e.flags&512&&e.wrap&4&&(e.check=T(e.check,n,f,a)),l-=f,a+=f,u)break e}else e.head&&(e.head.comment=null);e.mode=Ue;case Ue:if(e.flags&512){for(;s<16;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(e.wrap&4&&r!==(e.check&65535)){i.msg="header crc mismatch",e.mode=A;break}r=0,s=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=C;break;case Oe:for(;s<32;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}i.adler=e.check=Je(r),r=0,s=0,e.mode=ee;case ee:if(e.havedict===0)return i.next_out=c,i.avail_out=p,i.next_in=a,i.avail_in=l,e.hold=r,e.bits=s,Bi;i.adler=e.check=1,e.mode=C;case C:if(t===Ti||t===Y)break e;case se:if(e.last){r>>>=s&7,s-=s&7,e.mode=le;break}for(;s<3;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}switch(e.last=r&1,r>>>=1,s-=1,r&3){case 0:e.mode=Ne;break;case 1:if(Gi(e),e.mode=X,t===Y){r>>>=2,s-=2;break e}break;case 2:e.mode=$e;break;case 3:i.msg="invalid block type",e.mode=A}r>>>=2,s-=2;break;case Ne:for(r>>>=s&7,s-=s&7;s<32;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if((r&65535)!==(r>>>16^65535)){i.msg="invalid stored block lengths",e.mode=A;break}if(e.length=r&65535,r=0,s=0,e.mode=oe,t===Y)break e;case oe:e.mode=Ge;case Ge:if(f=e.length,f){if(f>l&&(f=l),f>p&&(f=p),f===0)break e;o.set(n.subarray(a,a+f),c),l-=f,a+=f,p-=f,c+=f,e.length-=f;break}e.mode=C;break;case $e:for(;s<14;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(e.nlen=(r&31)+257,r>>>=5,s-=5,e.ndist=(r&31)+1,r>>>=5,s-=5,e.ncode=(r&15)+4,r>>>=4,s-=4,e.nlen>286||e.ndist>30){i.msg="too many length or distance symbols",e.mode=A;break}e.have=0,e.mode=ze;case ze:for(;e.have<e.ncode;){for(;s<3;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}e.lens[R[e.have++]]=r&7,r>>>=3,s-=3}for(;e.have<19;)e.lens[R[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,g={bits:e.lenbits},I=z(vi,e.lens,0,19,e.lencode,0,e.work,g),e.lenbits=g.bits,I){i.msg="invalid code lengths set",e.mode=A;break}e.have=0,e.mode=He;case He:for(;e.have<e.nlen+e.ndist;){for(;m=e.lencode[r&(1<<e.lenbits)-1],b=m>>>24,k=m>>>16&255,w=m&65535,!(b<=s);){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(w<16)r>>>=b,s-=b,e.lens[e.have++]=w;else{if(w===16){for(S=b+2;s<S;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(r>>>=b,s-=b,e.have===0){i.msg="invalid bit length repeat",e.mode=A;break}u=e.lens[e.have-1],f=3+(r&3),r>>>=2,s-=2}else if(w===17){for(S=b+3;s<S;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}r>>>=b,s-=b,u=0,f=3+(r&7),r>>>=3,s-=3}else{for(S=b+7;s<S;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}r>>>=b,s-=b,u=0,f=11+(r&127),r>>>=7,s-=7}if(e.have+f>e.nlen+e.ndist){i.msg="invalid bit length repeat",e.mode=A;break}for(;f--;)e.lens[e.have++]=u}}if(e.mode===A)break;if(e.lens[256]===0){i.msg="invalid code -- missing end-of-block",e.mode=A;break}if(e.lenbits=9,g={bits:e.lenbits},I=z(ct,e.lens,0,e.nlen,e.lencode,0,e.work,g),e.lenbits=g.bits,I){i.msg="invalid literal/lengths set",e.mode=A;break}if(e.distbits=6,e.distcode=e.distdyn,g={bits:e.distbits},I=z(ut,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,g),e.distbits=g.bits,I){i.msg="invalid distances set",e.mode=A;break}if(e.mode=X,t===Y)break e;case X:e.mode=K;case K:if(l>=6&&p>=258){i.next_out=c,i.avail_out=p,i.next_in=a,i.avail_in=l,e.hold=r,e.bits=s,ki(i,d),c=i.next_out,o=i.output,p=i.avail_out,a=i.next_in,n=i.input,l=i.avail_in,r=e.hold,s=e.bits,e.mode===C&&(e.back=-1);break}for(e.back=0;m=e.lencode[r&(1<<e.lenbits)-1],b=m>>>24,k=m>>>16&255,w=m&65535,!(b<=s);){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(k&&(k&240)===0){for(h=b,y=k,P=w;m=e.lencode[P+((r&(1<<h+y)-1)>>h)],b=m>>>24,k=m>>>16&255,w=m&65535,!(h+b<=s);){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}r>>>=h,s-=h,e.back+=h}if(r>>>=b,s-=b,e.back+=b,e.length=w,k===0){e.mode=Ye;break}if(k&32){e.back=-1,e.mode=C;break}if(k&64){i.msg="invalid literal/length code",e.mode=A;break}e.extra=k&15,e.mode=Ze;case Ze:if(e.extra){for(S=e.extra;s<S;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}e.length+=r&(1<<e.extra)-1,r>>>=e.extra,s-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=We;case We:for(;m=e.distcode[r&(1<<e.distbits)-1],b=m>>>24,k=m>>>16&255,w=m&65535,!(b<=s);){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if((k&240)===0){for(h=b,y=k,P=w;m=e.distcode[P+((r&(1<<h+y)-1)>>h)],b=m>>>24,k=m>>>16&255,w=m&65535,!(h+b<=s);){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}r>>>=h,s-=h,e.back+=h}if(r>>>=b,s-=b,e.back+=b,k&64){i.msg="invalid distance code",e.mode=A;break}e.offset=w,e.extra=k&15,e.mode=Ve;case Ve:if(e.extra){for(S=e.extra;s<S;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}e.offset+=r&(1<<e.extra)-1,r>>>=e.extra,s-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.msg="invalid distance too far back",e.mode=A;break}e.mode=je;case je:if(p===0)break e;if(f=d-p,e.offset>f){if(f=e.offset-f,f>e.whave&&e.sane){i.msg="invalid distance too far back",e.mode=A;break}f>e.wnext?(f-=e.wnext,x=e.wsize-f):x=e.wnext-f,f>e.length&&(f=e.length),D=e.window}else D=o,x=c-e.offset,f=e.length;f>p&&(f=p),p-=f,e.length-=f;do o[c++]=D[x++];while(--f);e.length===0&&(e.mode=K);break;case Ye:if(p===0)break e;o[c++]=e.length,p--,e.mode=K;break;case le:if(e.wrap){for(;s<32;){if(l===0)break e;l--,r|=n[a++]<<s,s+=8}if(d-=p,i.total_out+=d,e.total+=d,e.wrap&4&&d&&(i.adler=e.check=e.flags?T(e.check,o,d,c-d):de(e.check,o,d,c-d)),d=p,e.wrap&4&&(e.flags?r:Je(r))!==e.check){i.msg="incorrect data check",e.mode=A;break}r=0,s=0}e.mode=Xe;case Xe:if(e.wrap&&e.flags){for(;s<32;){if(l===0)break e;l--,r+=n[a++]<<s,s+=8}if(e.wrap&4&&r!==(e.total&4294967295)){i.msg="incorrect length check",e.mode=A;break}r=0,s=0}e.mode=Ke;case Ke:I=Ci;break e;case A:I=dt;break e;case gt:return xt;case bt:default:return v}return i.next_out=c,i.avail_out=p,i.next_in=a,i.avail_in=l,e.hold=r,e.bits=s,(e.wsize||d!==i.avail_out&&e.mode<A&&(e.mode<le||t!==Pe))&&_t(i,i.output,i.next_out,d-i.avail_out),E-=i.avail_in,d-=i.avail_out,i.total_in+=E,i.total_out+=d,e.total+=d,e.wrap&4&&d&&(i.adler=e.check=e.flags?T(e.check,o,d,i.next_out-d):de(e.check,o,d,i.next_out-d)),i.data_type=e.bits+(e.last?64:0)+(e.mode===C?128:0)+(e.mode===X||e.mode===oe?256:0),(E===0&&d===0||t===Pe)&&I===F&&(I=Li),I},zi=i=>{if(U(i))return v;let t=i.state;return t.window&&(t.window=null),i.state=null,F},Hi=(i,t)=>{if(U(i))return v;const e=i.state;return(e.wrap&2)===0?v:(e.head=t,t.done=!1,F)},Zi=(i,t)=>{const e=t.length;let n,o,a;return U(i)||(n=i.state,n.wrap!==0&&n.mode!==ee)?v:n.mode===ee&&(o=1,o=de(o,t,e,0),o!==n.check)?dt:(a=_t(i,t,e,e),a?(n.mode=gt,xt):(n.havedict=1,F))};var Wi=pt,Vi=mt,ji=wt,Yi=Ni,Xi=yt,Ki=$i,Ji=zi,Qi=Hi,qi=Zi,en="pako inflate (from Nodeca project)",L={inflateReset:Wi,inflateReset2:Vi,inflateResetKeep:ji,inflateInit:Yi,inflateInit2:Xi,inflate:Ki,inflateEnd:Ji,inflateGetHeader:Qi,inflateSetDictionary:qi,inflateInfo:en};function tn(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var nn=tn;const St=Object.prototype.toString,{Z_NO_FLUSH:an,Z_FINISH:rn,Z_OK:Z,Z_STREAM_END:ce,Z_NEED_DICT:ue,Z_STREAM_ERROR:sn,Z_DATA_ERROR:qe,Z_MEM_ERROR:on}=lt;function ne(i){this.options=ft.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(i&&i.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _i,this.strm.avail_out=0;let e=L.inflateInit2(this.strm,t.windowBits);if(e!==Z)throw new Error(xe[e]);if(this.header=new nn,L.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ge.string2buf(t.dictionary):St.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=L.inflateSetDictionary(this.strm,t.dictionary),e!==Z)))throw new Error(xe[e])}ne.prototype.push=function(i,t){const e=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let a,c,l;if(this.ended)return!1;for(t===~~t?c=t:c=t===!0?rn:an,St.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),a=L.inflate(e,c),a===ue&&o&&(a=L.inflateSetDictionary(e,o),a===Z?a=L.inflate(e,c):a===qe&&(a=ue));e.avail_in>0&&a===ce&&e.state.wrap>0&&i[e.next_in]!==0;)L.inflateReset(e),a=L.inflate(e,c);switch(a){case sn:case qe:case ue:case on:return this.onEnd(a),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||a===ce))if(this.options.to==="string"){let p=ge.utf8border(e.output,e.next_out),r=e.next_out-p,s=ge.buf2string(e.output,p);e.next_out=r,e.avail_out=n-r,r&&e.output.set(e.output.subarray(p,p+r),0),this.onData(s)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===Z&&l===0)){if(a===ce)return a=L.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};ne.prototype.onData=function(i){this.chunks.push(i)};ne.prototype.onEnd=function(i){i===Z&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ft.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function ln(i,t){const e=new ne(t);if(e.push(i),e.err)throw e.msg||xe[e.err];return e.result}var fn=ln,hn={inflate:fn};const{inflate:cn}=hn;var un=cn;function dn(i){const t=new Uint8Array(i.buffer,i.byteOffset,i.byteLength),e=un(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const xn={ignoreImageData:!1};class G extends te{_nextIFD;constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),t===2)return!0;if(t===1)return!1;throw B("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw B("ifdCount",t)}decode(t={}){const{pages:e}=t;gn(e);const n=e?Math.max(...e):1/0;t={...xn,...t};const o=[];this.decodeHeader();let a=0;for(;this._nextIFD;){if(e){if(e.includes(a)?o.push(this.decodeIFD(t,!0)):this.decodeIFD({ignoreImageData:!0},!0),a===n)break}else o.push(this.decodeIFD(t,!0));a++}if(a<n&&n!==1/0)throw new RangeError(`Index ${n} is out of bounds. The stack only contains ${a} images.`);return o}decodeHeader(){const t=this.readUint16();if(t===18761)this.setLittleEndian();else if(t===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${t.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){this.seek(this._nextIFD);let n;if(e)n=new ke;else{if(!t.kind)throw new Error("kind is missing");n=new at(t.kind)}const o=this.readUint16();for(let a=0;a<o;a++)this.decodeIFDEntry(n);if(!t.ignoreImageData){if(!(n instanceof ke))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(t){const e=this.offset,n=this.readUint16(),o=this.readUint16(),a=this.readUint32();if(o<1||o>12){this.skip(4);return}Lt(o,a)>4&&this.seek(this.readUint32());const l=Rt(this,o,a);if(t.fields.set(n,l),n===34665||n===34853){const p=this.offset;let r="exif";n===34665?r="exif":n===34853&&(r="gps"),this._nextIFD=l,t[r]=this.decodeIFD({kind:r,ignoreImageData:!0},!1),this.offset=p}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&e!==1)throw B("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:t.tiled?this.readTileData(t):this.readStripData(t);break;default:throw B("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),t.bitsPerSample===1&&this.split1BitData(t),t.type===0){const o=2**t.bitsPerSample-1;for(let a=0;a<t.data.length;a++)t.data[a]=o-t.data[a]}}split1BitData(t){const{imageWidth:e,imageLength:n,samplesPerPixel:o}=t,a=new Uint8Array(n*e*o),c=Math.ceil(e*o/8);let l=0;for(let p=0;p<n;p++){const r=p*c;for(let s=0;s<e*o;s++){const E=r+Math.floor(s/8),d=7-s%8,f=t.data[E]>>d&1;a[l++]=f}}t.data=a}static uncompress(t,e=1){switch(e){case 1:return t;case 5:return Kt(t);case 8:case 32946:return dn(t);case 2:throw B("Compression","CCITT Group 3");case 32773:throw B("Compression","PackBits");default:throw B("Compression",e)}}createSampleReader(t,e,n){if(e===8||e===1)return(o,a)=>o.getUint8(a);if(e===16)return(o,a)=>o.getUint16(2*a,n);if(e===32&&t===3)return(o,a)=>o.getFloat32(4*a,n);if(e===64&&t===3)return(o,a)=>o.getFloat64(8*a,n);throw B("bitDepth",e)}readStripData(t){const e=t.width,n=t.height,o=t.bitsPerSample!==1?e*t.samplesPerPixel*n:Math.ceil(e*t.samplesPerPixel/8)*n,a=t.stripOffsets,c=t.stripByteCounts||Tt(t),l=this.isLittleEndian(),p=t.bitsPerSample!==1?e*t.samplesPerPixel*t.rowsPerStrip:Math.ceil(e*t.samplesPerPixel/8)*t.rowsPerStrip,r=this.createSampleReader(t.sampleFormat,t.bitsPerSample,l),s=et(o,t.bitsPerSample,t.sampleFormat);let E=0;for(let d=0;d<a.length;d++){const f=new DataView(this.buffer,this.byteOffset+a[d],c[d]),x=G.uncompress(f,t.compression),D=Math.min(p,o-E);for(let m=0;m<D;++m){const b=r(x,m);s[E+m]=b}E+=D}t.data=s}readTileData(t){if(!t.tileWidth||!t.tileHeight)return;const e=t.width,n=t.height,o=t.bitsPerSample!==1?e*n*t.samplesPerPixel:Math.ceil(e*t.samplesPerPixel/8)*n,a=t.tileWidth,c=t.tileHeight,l=Math.ceil(e/a),p=Math.ceil(n/c),r=t.tileOffsets,s=t.tileByteCounts,E=this.isLittleEndian(),d=this.createSampleReader(t.sampleFormat,t.bitsPerSample,E),f=et(o,t.bitsPerSample,t.sampleFormat);for(let x=0;x<l;++x)for(let D=0;D<p;++D){const m=D*l+x,b=new DataView(this.buffer,this.byteOffset+r[m],s[m]),k=G.uncompress(b,t.compression);if(t.bitsPerSample===1){const w=Math.ceil(e/8),h=Math.ceil(a/8);for(let y=0;y<c&&D*c+y<n;y++){const P=D*c+y,u=y*h,I=P*w+Math.floor(x*a/8),_=Math.min(h,w-Math.floor(x*a/8));for(let g=0;g<_;g++)f[I+g]=d(k,u+g)}}else for(let w=0;w<c;w++)for(let h=0;h<a;h++){const y=x*a+h,P=D*c+w;if(y>=e||P>=n)continue;const u=w*a+h,I=d(k,u),_=(P*e+y)*t.samplesPerPixel;f[_]=I}}t.data=f}applyPredictor(t){const e=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:{if(e===8)Ct(t.data,t.width,t.components);else if(e===16)Bt(t.data,t.width,t.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${e}`);break}default:throw new Error(`invalid predictor: ${t.predictor}`)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:e,components:n,maxSampleValue:o}=t;for(let a=0;a<e.length;a+=n){const c=e[a+n-1];for(let l=0;l<n-1;l++)e[a+l]=Math.round(e[a+l]*o/c)}}}}function et(i,t,e){if(t===8||t===1)return new Uint8Array(i);if(t===16)return new Uint16Array(i);if(t===32&&e===3)return new Float32Array(i);if(t===64&&e===3)return new Float64Array(i);throw B("bit depth / sample format",`${t} / ${e}`)}function B(i,t){return new Error(`Unsupported ${i}: ${t}`)}function gn(i){if(i){for(const t of i)if(t<0||!Number.isInteger(t))throw new RangeError(`Index ${t} is invalid. Must be a positive integer.`)}}function bn(i,t){return new G(i).decode(t)}function wn(i){return new G(i).isMultiPage}function pn(i){return new G(i).pageCount}const mn={exif:J,gps:Q,standard:q};export{ke as TiffIfd,bn as decode,wn as isMultiPage,pn as pageCount,mn as tagNames};
