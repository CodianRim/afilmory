import{r as _,c as re,j as s}from"../vendor/1-CkNOVE2J.js";import{g as Ie}from"./style-y-HurESQ.js";import{d as Me,e as ge,f as Te,u as Ue,a as Fe,M as Ae}from"./logo-control-BmpN82vv.js";import{J as ke,I as ce,K as Le,aC as Ee,b3 as ze,b4 as De,b5 as $e,a3 as Oe}from"./index-87VEuC2R.js";import{T as Pe}from"./index-BA3Pg0dP.js";import{u as He}from"../vendor/2-VRqxSGaj.js";import{G as Ze}from"./MapSection-CMoMlSgI.js";var _e=new Map,xe=new WeakMap,Ce=0,Be;function Ge(o){return o?(xe.has(o)||(Ce+=1,xe.set(o,Ce.toString())),xe.get(o)):"0"}function Ve(o){return Object.keys(o).sort().filter(e=>o[e]!==void 0).map(e=>`${e}_${e==="root"?Ge(o.root):o[e]}`).toString()}function Ke(o){const e=Ve(o);let t=_e.get(e);if(!t){const l=new Map;let a;const n=new IntersectionObserver(i=>{i.forEach(r=>{var h;const x=r.isIntersecting&&a.some(u=>r.intersectionRatio>=u);o.trackVisibility&&typeof r.isVisible>"u"&&(r.isVisible=x),(h=l.get(r.target))==null||h.forEach(u=>{u(x,r)})})},o);a=n.thresholds||(Array.isArray(o.threshold)?o.threshold:[o.threshold||0]),t={id:e,observer:n,elements:l},_e.set(e,t)}return t}function We(o,e,t={},l=Be){if(typeof window.IntersectionObserver>"u"&&l!==void 0){const h=o.getBoundingClientRect();return e(l,{isIntersecting:l,target:o,intersectionRatio:typeof t.threshold=="number"?t.threshold:0,time:0,boundingClientRect:h,intersectionRect:h,rootBounds:h}),()=>{}}const{id:a,observer:n,elements:i}=Ke(t),r=i.get(o)||[];return i.has(o)||i.set(o,r),r.push(e),n.observe(o),function(){r.splice(r.indexOf(e),1),r.length===0&&(i.delete(o),n.unobserve(o)),i.size===0&&(n.disconnect(),_e.delete(a))}}function qe({threshold:o,delay:e,trackVisibility:t,rootMargin:l,root:a,triggerOnce:n,skip:i,initialInView:r,fallbackInView:h,onChange:x}={}){var u;const[d,k]=_.useState(null),b=_.useRef(x),N=_.useRef(r),[S,L]=_.useState({inView:!!r,entry:void 0});b.current=x,_.useEffect(()=>{if(N.current===void 0&&(N.current=r),i||!d)return;let g;return g=We(d,(m,p)=>{const C=N.current;N.current=m,!(C===void 0&&!m)&&(L({inView:m,entry:p}),b.current&&b.current(m,p),p.isIntersecting&&n&&g&&(g(),g=void 0))},{root:a,rootMargin:l,threshold:o,trackVisibility:t,delay:e},h),()=>{g&&g()}},[Array.isArray(o)?o.toString():o,d,a,l,n,i,t,h,e]);const v=(u=S.entry)==null?void 0:u.target,j=_.useRef(void 0);!d&&v&&!n&&!i&&j.current!==v&&(j.current=v,L({inView:!!r,entry:void 0}),N.current=r);const y=[k,S.inView,S.entry];return y.ref=y[0],y.inView=y[1],y.entry=y[2],y}const pe=o=>{const e=re.c(28),{src:t,alt:l,thumbHash:a,className:n,style:i,onLoad:r,onError:h,rootMargin:x,threshold:u}=o,d=x===void 0?"50px":x,k=u===void 0?.1:u,[b,N]=_.useState(!1),[S,L]=_.useState(!1);let v;e[0]!==d||e[1]!==k?(v={triggerOnce:!0,rootMargin:d,threshold:k},e[0]=d,e[1]=k,e[2]=v):v=e[2];const{ref:j,inView:y}=qe(v);let g;e[3]!==r?(g=()=>{N(!0),r?.()},e[3]=r,e[4]=g):g=e[4];const m=g;let p;e[5]!==h?(p=()=>{L(!0),h?.()},e[5]=h,e[6]=p):p=e[6];const C=p,E=y&&!S;let M;e[7]!==n?(M=ke("relative overflow-hidden",n),e[7]=n,e[8]=M):M=e[8];let T;e[9]!==b||e[10]!==a?(T=a&&!b&&s.jsx(Pe,{thumbHash:a,className:"absolute inset-0 scale-110 blur-sm"}),e[9]=b,e[10]=a,e[11]=T):T=e[11];let c;e[12]!==l||e[13]!==C||e[14]!==m||e[15]!==b||e[16]!==E||e[17]!==t?(c=E&&s.jsx("img",{src:t,alt:l,className:ke("h-full w-full object-cover transition-opacity duration-300",b?"opacity-100":"opacity-0"),onLoad:m,onError:C,loading:"lazy"}),e[12]=l,e[13]=C,e[14]=m,e[15]=b,e[16]=E,e[17]=t,e[18]=c):c=e[18];let w;e[19]!==S?(w=S&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-800",children:s.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Failed to load image"})}),e[19]=S,e[20]=w):w=e[20];let f;return e[21]!==j||e[22]!==i||e[23]!==M||e[24]!==T||e[25]!==c||e[26]!==w?(f=s.jsxs("div",{ref:j,className:M,style:i,children:[T,c,w]}),e[21]=j,e[22]=i,e[23]=M,e[24]=T,e[25]=c,e[26]=w,e[27]=f):f=e[27],f};function be(o,e){if(!o)throw new Error(e)}let Ye=0;function Je(o,e,t){if(o.style&&o.style._loaded){const l={...t};return delete l.id,delete l.children,o.addSource(e,l),o.getSource(e)}return null}function Qe(o,e,t){be(e.id===t.id,"source id changed"),be(e.type===t.type,"source type changed");let l="",a=0;for(const i in e)i!=="children"&&i!=="id"&&!ge(t[i],e[i])&&(l=i,a++);if(!a)return;const n=e.type;if(n==="geojson")o.setData(e.data);else if(n==="image")o.updateImage({url:e.url,coordinates:e.coordinates});else switch(l){case"coordinates":o.setCoordinates?.(e.coordinates);break;case"url":o.setUrl?.(e.url);break;case"tiles":o.setTiles?.(e.tiles);break;default:console.warn(`Unable to update <Source> prop: ${l}`)}}function Xe(o){const e=_.useContext(Me).map.getMap(),t=_.useRef(o),[,l]=_.useState(0),a=_.useMemo(()=>o.id||`jsx-source-${Ye++}`,[]);_.useEffect(()=>{if(e){const i=()=>setTimeout(()=>l(r=>r+1),0);return e.on("styledata",i),i(),()=>{if(e.off("styledata",i),e.style&&e.style._loaded&&e.getSource(a)){const r=e.getStyle()?.layers;if(r)for(const h of r)h.source===a&&e.removeLayer(h.id);e.removeSource(a)}}}},[e]);let n=e&&e.style&&e.getSource(a);return n?Qe(n,o,t.current):n=Je(e,a,o),t.current=o,n&&_.Children.map(o.children,i=>i&&_.cloneElement(i,{source:a}))||null}function et(o,e,t,l){if(be(t.id===l.id,"layer id changed"),be(t.type===l.type,"layer type changed"),t.type==="custom"||l.type==="custom")return;const{layout:a={},paint:n={},filter:i,minzoom:r,maxzoom:h,beforeId:x}=t;if(x!==l.beforeId&&o.moveLayer(e,x),a!==l.layout){const u=l.layout||{};for(const d in a)ge(a[d],u[d])||o.setLayoutProperty(e,d,a[d]);for(const d in u)a.hasOwnProperty(d)||o.setLayoutProperty(e,d,void 0)}if(n!==l.paint){const u=l.paint||{};for(const d in n)ge(n[d],u[d])||o.setPaintProperty(e,d,n[d]);for(const d in u)n.hasOwnProperty(d)||o.setPaintProperty(e,d,void 0)}ge(i,l.filter)||o.setFilter(e,i),(r!==l.minzoom||h!==l.maxzoom)&&o.setLayerZoomRange(e,r,h)}function tt(o,e,t){if(o.style&&o.style._loaded&&(!("source"in t)||o.getSource(t.source))){const l={...t,id:e};delete l.beforeId,o.addLayer(l,t.beforeId)}}let st=0;function ot(o){const e=_.useContext(Me).map.getMap(),t=_.useRef(o),[,l]=_.useState(0),a=_.useMemo(()=>o.id||`jsx-layer-${st++}`,[]);if(_.useEffect(()=>{if(e){const i=()=>l(r=>r+1);return e.on("styledata",i),i(),()=>{e.off("styledata",i),e.style&&e.style._loaded&&e.getLayer(a)&&e.removeLayer(a)}}},[e]),e&&e.style&&e.getLayer(a))try{et(e,a,o,t.current)}catch(i){console.warn(i)}else tt(e,a,o);return t.current=o,null}function it(o,e){if(o.length===0)return[];if(e>=15)return o.map(n=>({type:"Feature",properties:{marker:n},geometry:{type:"Point",coordinates:[n.longitude,n.latitude]}}));const t=[],l=new Set,a=Math.max(.001,.01/Math.pow(2,e-10));for(const n of o){if(l.has(n.id))continue;const i=[n];l.add(n.id);for(const r of o){if(l.has(r.id))continue;Math.sqrt(Math.pow(n.longitude-r.longitude,2)+Math.pow(n.latitude-r.latitude,2))<a&&(i.push(r),l.add(r.id))}if(i.length===1)t.push({type:"Feature",properties:{marker:n},geometry:{type:"Point",coordinates:[n.longitude,n.latitude]}});else{const r=i.reduce((x,u)=>x+u.longitude,0)/i.length,h=i.reduce((x,u)=>x+u.latitude,0)/i.length;t.push({type:"Feature",properties:{cluster:!0,point_count:i.length,point_count_abbreviated:i.length.toString(),marker:i[0],clusteredPhotos:i},geometry:{type:"Point",coordinates:[r,h]}})}}return t}const lt=o=>{const e=re.c(28),{photos:t,onPhotoClick:l}=o,a=t.slice(0,6),n=Math.max(0,t.length-6),{t:i,i18n:r}=He(),h="space-y-3";let x;e[0]!==t.length||e[1]!==i?(x=i("explory.cluster.photos",{count:t.length}),e[0]=t.length,e[1]=i,e[2]=x):x=e[2];let u;e[3]!==x?(u=s.jsx("h3",{className:"text-text text-sm font-semibold",children:x}),e[3]=x,e[4]=u):u=e[4];let d;e[5]!==i?(d=i("explory.cluster.click.details"),e[5]=i,e[6]=d):d=e[6];let k;e[7]!==d?(k=s.jsx("div",{className:"text-text-secondary text-xs",children:d}),e[7]=d,e[8]=k):k=e[8];let b;e[9]!==u||e[10]!==k?(b=s.jsxs("div",{className:"flex items-center justify-between",children:[u,k]}),e[9]=u,e[10]=k,e[11]=b):b=e[11];const N="grid grid-cols-3 gap-2";let S;e[12]!==l?(S=(m,p)=>s.jsx(ce.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{...Le.presets.smooth,delay:p*.05},className:"group relative aspect-square overflow-hidden rounded-lg",children:s.jsxs(Ee,{to:`/${m.photo.id}`,target:"_blank",onClick:C=>{C.stopPropagation(),l?.(m)},className:"block h-full w-full",children:[s.jsx(pe,{src:m.photo.thumbnailUrl||m.photo.originalUrl,alt:m.photo.title||m.photo.id,thumbHash:m.photo.thumbHash,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",rootMargin:"200px",threshold:.1}),s.jsx("div",{className:"absolute inset-0 bg-black/0 transition-colors duration-300 group-hover:bg-black/20"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 transition-opacity duration-300 group-hover:opacity-100",children:s.jsx("div",{className:"rounded-full bg-black/50 p-2 backdrop-blur-sm",children:s.jsx("svg",{className:"h-4 w-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})})]})},m.photo.id),e[12]=l,e[13]=S):S=e[13];const L=a.map(S);let v;e[14]!==a||e[15]!==n||e[16]!==i?(v=n>0&&s.jsx(ce.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{...Le.presets.smooth,delay:a.length*.05},className:"bg-fill-secondary flex aspect-square items-center justify-center rounded-lg",children:s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-text text-lg font-bold",children:["+",n]}),s.jsx("div",{className:"text-text-secondary text-xs",children:i("explory.cluster.more")})]})}),e[14]=a,e[15]=n,e[16]=i,e[17]=v):v=e[17];let j;e[18]!==v||e[19]!==L?(j=s.jsxs("div",{className:N,children:[L,v]}),e[18]=v,e[19]=L,e[20]=j):j=e[20];let y;e[21]!==r||e[22]!==t?(y=t[0]&&s.jsxs("div",{className:"border-border space-y-2 border-t pt-3",children:[s.jsxs("div",{className:"text-text-secondary flex items-center gap-2 text-xs",children:[s.jsx("i",{className:"i-mingcute-location-line text-sm"}),s.jsxs("span",{className:"font-mono",children:[Math.abs(t[0].latitude).toFixed(4),"°",t[0].latitudeRef||"N",","," ",Math.abs(t[0].longitude).toFixed(4),"°",t[0].longitudeRef||"E"]})]}),(()=>{const m=t.map(nt).filter(Boolean).map(at).sort(rt);if(m.length===0)return null;const p=m[0],C=m.at(-1),E=p.toDateString()===C?.toDateString();return s.jsxs("div",{className:"text-text-secondary flex items-center gap-2 text-xs",children:[s.jsx("i",{className:"i-mingcute-calendar-line text-sm"}),s.jsx("span",{children:E?p.toLocaleDateString(r.language,{year:"numeric",month:"short",day:"numeric"}):`${p.toLocaleDateString(r.language,{month:"short",day:"numeric",year:"numeric"})} - ${C?.toLocaleDateString(r.language,{month:"short",day:"numeric",year:"numeric"})}`})]})})()]}),e[21]=r,e[22]=t,e[23]=y):y=e[23];let g;return e[24]!==j||e[25]!==y||e[26]!==b?(g=s.jsxs("div",{className:h,children:[b,j,y]}),e[24]=j,e[25]=y,e[26]=b,e[27]=g):g=e[27],g};function nt(o){return o.photo.exif?.DateTimeOriginal}function at(o){return new Date(o)}function rt(o,e){return o.getTime()-e.getTime()}const ct=o=>{const e=re.c(77),{longitude:t,latitude:l,pointCount:a,clusteredPhotos:n,onClusterClick:i}=o;let r,h,x,u,d,k,b,N,S,L,v,j,y,g,m,p,C,E,M,T,c;if(e[0]!==l||e[1]!==t||e[2]!==i||e[3]!==a||e[4]!==n){d=n===void 0?[]:n;const F=Math.min(64,Math.max(40,32+Math.log(a)*8));u=Te,j=t,y=l,x=ze,L=300,v=150,h=De,S=!0,r=ce.div,C="group relative cursor-pointer",e[26]===Symbol.for("react.memo_cache_sentinel")?(E={scale:0},M={scale:1},T={type:"spring",stiffness:300,damping:25},c={scale:1.05},k={scale:.95},e[26]=k,e[27]=E,e[28]=M,e[29]=T,e[30]=c):(k=e[26],E=e[27],M=e[28],T=e[29],c=e[30]),e[31]!==l||e[32]!==t||e[33]!==i?(b=()=>i?.(t,l),e[31]=l,e[32]=t,e[33]=i,e[34]=b):b=e[34];const A=F+12,O=F+12;e[35]!==A||e[36]!==O?(N=s.jsx("div",{className:"bg-blue/20 absolute inset-0 animate-pulse rounded-full opacity-60",style:{width:A,height:O,left:-6,top:-6}}),e[35]=A,e[36]=O,e[37]=N):N=e[37],g="relative flex items-center justify-center rounded-full border border-white/40 bg-white/95 shadow-lg backdrop-blur-md transition-all duration-300 hover:bg-white hover:shadow-xl dark:border-white/10 dark:bg-black/80 dark:hover:bg-black/90",e[38]!==F?(m={width:F,height:F},e[38]=F,e[39]=m):m=e[39],p=d.length>0&&s.jsxs("div",{className:"absolute inset-1 overflow-hidden rounded-full",children:[d.slice(0,4).map(dt),s.jsx("div",{className:"from-blue/40 to-indigo/60 absolute inset-0 bg-gradient-to-br"})]}),e[0]=l,e[1]=t,e[2]=i,e[3]=a,e[4]=n,e[5]=r,e[6]=h,e[7]=x,e[8]=u,e[9]=d,e[10]=k,e[11]=b,e[12]=N,e[13]=S,e[14]=L,e[15]=v,e[16]=j,e[17]=y,e[18]=g,e[19]=m,e[20]=p,e[21]=C,e[22]=E,e[23]=M,e[24]=T,e[25]=c}else r=e[5],h=e[6],x=e[7],u=e[8],d=e[9],k=e[10],b=e[11],N=e[12],S=e[13],L=e[14],v=e[15],j=e[16],y=e[17],g=e[18],m=e[19],p=e[20],C=e[21],E=e[22],M=e[23],T=e[24],c=e[25];let w;e[40]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/30 to-white/10 dark:from-white/20 dark:to-white/5"}),e[40]=w):w=e[40];let f;e[41]!==a?(f=s.jsx("div",{className:"relative z-10 flex flex-col items-center text-xs",children:s.jsx("span",{className:"text-text font-bold",children:a})}),e[41]=a,e[42]=f):f=e[42];let H;e[43]===Symbol.for("react.memo_cache_sentinel")?(H=s.jsx("div",{className:"absolute inset-0 rounded-full shadow-inner shadow-black/5"}),e[43]=H):H=e[43];let z;e[44]!==f||e[45]!==g||e[46]!==m||e[47]!==p?(z=s.jsxs("div",{className:g,style:m,children:[p,w,f,H]}),e[44]=f,e[45]=g,e[46]=m,e[47]=p,e[48]=z):z=e[48];let $;e[49]!==r||e[50]!==k||e[51]!==b||e[52]!==N||e[53]!==z||e[54]!==C||e[55]!==E||e[56]!==M||e[57]!==T||e[58]!==c?($=s.jsxs(r,{className:C,initial:E,animate:M,transition:T,whileHover:c,whileTap:k,onClick:b,children:[N,z]}),e[49]=r,e[50]=k,e[51]=b,e[52]=N,e[53]=z,e[54]=C,e[55]=E,e[56]=M,e[57]=T,e[58]=c,e[59]=$):$=e[59];let D;e[60]!==h||e[61]!==S||e[62]!==$?(D=s.jsx(h,{asChild:S,children:$}),e[60]=h,e[61]=S,e[62]=$,e[63]=D):D=e[63];let R;e[64]!==d?(R=s.jsx($e,{className:"w-80 overflow-hidden border-white/20 bg-white/95 p-0 backdrop-blur-[120px] dark:bg-black/95",side:"top",align:"center",sideOffset:8,children:s.jsx("div",{className:"p-4",children:s.jsx(lt,{photos:d,onPhotoClick:ut})})}),e[64]=d,e[65]=R):R=e[65];let I;e[66]!==x||e[67]!==L||e[68]!==v||e[69]!==D||e[70]!==R?(I=s.jsxs(x,{openDelay:L,closeDelay:v,children:[D,R]}),e[66]=x,e[67]=L,e[68]=v,e[69]=D,e[70]=R,e[71]=I):I=e[71];let U;return e[72]!==u||e[73]!==j||e[74]!==y||e[75]!==I?(U=s.jsx(u,{longitude:j,latitude:y,children:I}),e[72]=u,e[73]=j,e[74]=y,e[75]=I,e[76]=U):U=e[76],U};function dt(o,e){const l=[{left:"0%",top:"0%",width:"50%",height:"50%"},{left:"50%",top:"0%",width:"50%",height:"50%"},{left:"0%",top:"50%",width:"50%",height:"50%"},{left:"50%",top:"50%",width:"50%",height:"50%"}][e];return s.jsx("div",{className:"absolute opacity-30",style:l,children:s.jsx(pe,{src:o.photo.thumbnailUrl||o.photo.originalUrl,alt:o.photo.title||o.photo.id,thumbHash:o.photo.thumbHash,className:"h-full w-full object-cover",rootMargin:"100px",threshold:.1})},o.photo.id)}function ut(o){}const ft={id:"data",type:"fill",paint:{"fill-color":"#0080ff","fill-opacity":.5}},ht=o=>{const e=re.c(5),{data:t,layerStyle:l}=o,a=l===void 0?ft:l;let n;e[0]!==a?(n=s.jsx(ot,{...a}),e[0]=a,e[1]=n):n=e[1];let i;return e[2]!==t||e[3]!==n?(i=s.jsx(Xe,{type:"geojson",data:t,children:n}),e[2]=t,e[3]=n,e[4]=i):i=e[4],i},mt=o=>{const e=re.c(44),{onGeolocate:t}=o,{current:l}=Ue(),{t:a}=He();let n;e[0]!==l?(n=()=>{if(l){const z=l.getZoom();l.easeTo({zoom:z+1,duration:300})}},e[0]=l,e[1]=n):n=e[1];const i=n;let r;e[2]!==l?(r=()=>{if(l){const z=l.getZoom();l.easeTo({zoom:z-1,duration:300})}},e[2]=l,e[3]=r):r=e[3];const h=r;let x;e[4]!==l?(x=()=>{l&&l.easeTo({bearing:0,pitch:0,duration:500})},e[4]=l,e[5]=x):x=e[5];const u=x;let d;e[6]!==l||e[7]!==t?(d=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(z=>{const{longitude:$,latitude:D}=z.coords;l&&l.flyTo({center:[$,D],zoom:14,duration:1e3}),t?.($,D)},xt,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},e[6]=l,e[7]=t,e[8]=d):d=e[8];const k=d;let b,N,S;e[9]===Symbol.for("react.memo_cache_sentinel")?(b={opacity:0,x:-20},N={opacity:1,x:0},S={duration:.4,delay:.2},e[9]=b,e[10]=N,e[11]=S):(b=e[9],N=e[10],S=e[11]);let L;e[12]!==a?(L=a("explory.controls.zoom.in"),e[12]=a,e[13]=L):L=e[13];let v;e[14]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx("i",{className:"i-mingcute-add-line text-text size-5 transition-transform group-hover:scale-110 group-active:scale-95"}),e[14]=v):v=e[14];let j;e[15]!==i||e[16]!==L?(j=s.jsx("button",{type:"button",onClick:i,className:"group hover:bg-fill-secondary active:bg-fill-tertiary flex h-12 w-12 items-center justify-center transition-colors",title:L,children:v}),e[15]=i,e[16]=L,e[17]=j):j=e[17];let y;e[18]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx("div",{className:"bg-fill-secondary h-px w-full"}),e[18]=y):y=e[18];let g;e[19]!==a?(g=a("explory.controls.zoom.out"),e[19]=a,e[20]=g):g=e[20];let m;e[21]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx("i",{className:"i-mingcute-minimize-line text-text size-5 transition-transform group-hover:scale-110 group-active:scale-95"}),e[21]=m):m=e[21];let p;e[22]!==h||e[23]!==g?(p=s.jsx("button",{type:"button",onClick:h,className:"group hover:bg-fill-secondary active:bg-fill-tertiary flex h-12 w-12 items-center justify-center transition-colors",title:g,children:m}),e[22]=h,e[23]=g,e[24]=p):p=e[24];let C;e[25]!==j||e[26]!==p?(C=s.jsxs("div",{className:"bg-material-thick border-fill-tertiary flex flex-col overflow-hidden rounded-2xl border shadow-2xl backdrop-blur-[120px]",children:[j,y,p]}),e[25]=j,e[26]=p,e[27]=C):C=e[27];let E;e[28]!==a?(E=a("explory.controls.compass"),e[28]=a,e[29]=E):E=e[29];let M;e[30]===Symbol.for("react.memo_cache_sentinel")?(M=s.jsx("i",{className:"i-mingcute-navigation-line text-text size-5 transition-transform group-hover:scale-110 group-active:scale-95"}),e[30]=M):M=e[30];let T;e[31]!==u||e[32]!==E?(T=s.jsx("div",{className:"bg-material-thick border-fill-tertiary overflow-hidden rounded-2xl border shadow-2xl backdrop-blur-[120px]",children:s.jsx("button",{type:"button",onClick:u,className:"group hover:bg-fill-secondary active:bg-fill-tertiary flex h-12 w-12 items-center justify-center transition-colors",title:E,children:M})}),e[31]=u,e[32]=E,e[33]=T):T=e[33];let c;e[34]!==a?(c=a("explory.controls.locate"),e[34]=a,e[35]=c):c=e[35];let w;e[36]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx("i",{className:"i-mingcute-location-fill text-text size-5 transition-transform group-hover:scale-110 group-active:scale-95"}),e[36]=w):w=e[36];let f;e[37]!==k||e[38]!==c?(f=s.jsx("div",{className:"bg-material-thick border-fill-tertiary overflow-hidden rounded-2xl border shadow-2xl backdrop-blur-[120px]",children:s.jsx("button",{type:"button",onClick:k,className:"group hover:bg-fill-secondary active:bg-fill-tertiary flex h-12 w-12 items-center justify-center transition-colors",title:c,children:w})}),e[37]=k,e[38]=c,e[39]=f):f=e[39];let H;return e[40]!==C||e[41]!==T||e[42]!==f?(H=s.jsxs(ce.div,{className:"absolute bottom-4 left-4 z-40 flex flex-col gap-3",initial:b,animate:N,transition:S,children:[C,T,f]}),e[40]=C,e[41]=T,e[42]=f,e[43]=H):H=e[43],H};function xt(o){console.warn("Geolocation error:",o)}const gt=o=>{const e=re.c(104),{marker:t,isSelected:l,onClick:a,onClose:n}=o,i=l===void 0?!1:l;let r;e[0]!==t||e[1]!==a?(r=()=>{a?.(t)},e[0]=t,e[1]=a,e[2]=r):r=e[2];const h=r;let x;e[3]!==n?(x=Re=>{Re.stopPropagation(),n?.()},e[3]=n,e[4]=x):x=e[4];const u=x,d=t.id,k=t.longitude,b=t.latitude,N=i?!0:void 0,S=i?0:400,L=i?0:100;let v,j,y,g,m;e[5]===Symbol.for("react.memo_cache_sentinel")?(v={scale:0},j={scale:1},y={type:"spring",stiffness:400,damping:30},g={scale:1.1},m={scale:.9},e[5]=v,e[6]=j,e[7]=y,e[8]=g,e[9]=m):(v=e[5],j=e[6],y=e[7],g=e[8],m=e[9]);let p;e[10]!==i?(p=i&&s.jsx("div",{className:"bg-blue/30 absolute inset-0 -m-2 animate-pulse rounded-full"}),e[10]=i,e[11]=p):p=e[11];const C=t.photo.thumbnailUrl||t.photo.originalUrl,E=t.photo.title||t.photo.id;let M;e[12]!==t.photo.thumbHash||e[13]!==C||e[14]!==E?(M=s.jsx(pe,{src:C,alt:E,thumbHash:t.photo.thumbHash,className:"h-full w-full object-cover opacity-40",rootMargin:"100px",threshold:.1}),e[12]=t.photo.thumbHash,e[13]=C,e[14]=E,e[15]=M):M=e[15];let T;e[16]===Symbol.for("react.memo_cache_sentinel")?(T=s.jsx("div",{className:"from-green/60 to-emerald/80 dark:from-green/70 dark:to-emerald/90 absolute inset-0 bg-gradient-to-br"}),e[16]=T):T=e[16];let c;e[17]!==M?(c=s.jsxs("div",{className:"absolute inset-0 overflow-hidden rounded-full",children:[M,T]}),e[17]=M,e[18]=c):c=e[18];const w=`relative flex h-10 w-10 items-center justify-center rounded-full border shadow-lg backdrop-blur-md transition-all duration-300 hover:shadow-xl ${i?"border-blue/40 bg-blue/90 shadow-blue/50 dark:border-blue/30 dark:bg-blue/80":"border-white/40 bg-white/95 hover:bg-white dark:border-white/20 dark:bg-black/80 dark:hover:bg-black/90"}`;let f;e[19]===Symbol.for("react.memo_cache_sentinel")?(f=s.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/30 to-white/10 dark:from-white/20 dark:to-white/5"}),e[19]=f):f=e[19];const H=`i-mingcute-camera-line relative z-10 text-lg drop-shadow-sm ${i?"text-white":"text-gray-700 dark:text-white"}`;let z;e[20]!==H?(z=s.jsx("i",{className:H}),e[20]=H,e[21]=z):z=e[21];let $;e[22]===Symbol.for("react.memo_cache_sentinel")?($=s.jsx("div",{className:"absolute inset-0 rounded-full shadow-inner shadow-black/5"}),e[22]=$):$=e[22];let D;e[23]!==w||e[24]!==z?(D=s.jsxs("div",{className:w,children:[f,z,$]}),e[23]=w,e[24]=z,e[25]=D):D=e[25];let R;e[26]!==h||e[27]!==p||e[28]!==c||e[29]!==D?(R=s.jsx(De,{asChild:!0,children:s.jsxs(ce.div,{className:"group relative cursor-pointer",initial:v,animate:j,transition:y,whileHover:g,whileTap:m,onClick:h,children:[p,c,D]})}),e[26]=h,e[27]=p,e[28]=c,e[29]=D,e[30]=R):R=e[30];const I=`w-80 overflow-hidden border-white/20 bg-white/95 p-0 backdrop-blur-[120px] dark:bg-black/95 ${i?"shadow-2xl":""}`,U=i?pt:void 0,F=i?bt:void 0;let A;e[31]!==u||e[32]!==i?(A=i&&s.jsx(Ze,{className:"absolute top-3 right-3 z-10 size-8",onClick:u,children:s.jsx("i",{className:"i-mingcute-close-line text-lg"})}),e[31]=u,e[32]=i,e[33]=A):A=e[33];const O=t.photo.thumbnailUrl||t.photo.originalUrl,ye=t.photo.title||t.photo.id;let P;e[34]!==t.photo.thumbHash||e[35]!==O||e[36]!==ye?(P=s.jsx(pe,{src:O,alt:ye,thumbHash:t.photo.thumbHash,className:"h-full w-full object-cover",rootMargin:"200px",threshold:.1}),e[34]=t.photo.thumbHash,e[35]=O,e[36]=ye,e[37]=P):P=e[37];let de;e[38]===Symbol.for("react.memo_cache_sentinel")?(de=s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"}),e[38]=de):de=e[38];let Z;e[39]!==P?(Z=s.jsxs("div",{className:"relative h-32 overflow-hidden",children:[P,de]}),e[39]=P,e[40]=Z):Z=e[40];const ve=`/${t.photo.id}`,je=t.photo.title||t.photo.id,we=t.photo.title||t.photo.id;let B;e[41]!==je||e[42]!==we?(B=s.jsx("h3",{className:"text-text flex-1 truncate text-sm font-semibold",title:je,children:we}),e[41]=je,e[42]=we,e[43]=B):B=e[43];let ue;e[44]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx("i",{className:"i-mingcute-arrow-right-line text-text-secondary transition-transform group-hover/link:translate-x-0.5"}),e[44]=ue):ue=e[44];let G;e[45]!==ve||e[46]!==B?(G=s.jsxs(Ee,{to:ve,target:"_blank",className:"group/link hover:text-blue flex items-center gap-2 transition-colors",children:[B,ue]}),e[45]=ve,e[46]=B,e[47]=G):G=e[47];let V;e[48]!==t.photo.exif?(V=t.photo.exif?.DateTimeOriginal&&s.jsxs("div",{className:"text-text-secondary flex items-center gap-2 text-xs",children:[s.jsx("i",{className:"i-mingcute-calendar-line text-sm"}),s.jsx("span",{children:new Date(t.photo.exif.DateTimeOriginal).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})})]}),e[48]=t.photo.exif,e[49]=V):V=e[49];let K;e[50]!==t.photo.exif?(K=t.photo.exif?.Make&&t.photo.exif?.Model&&s.jsxs("div",{className:"text-text-secondary flex items-center gap-2 text-xs",children:[s.jsx("i",{className:"i-mingcute-camera-line text-sm"}),s.jsxs("span",{className:"truncate",children:[t.photo.exif.Make," ",t.photo.exif.Model]})]}),e[50]=t.photo.exif,e[51]=K):K=e[51];let fe;e[52]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx("i",{className:"i-mingcute-location-line text-sm"}),e[52]=fe):fe=e[52];let W;e[53]!==t.latitude?(W=Math.abs(t.latitude).toFixed(4),e[53]=t.latitude,e[54]=W):W=e[54];let q;e[55]!==W?(q=s.jsxs("span",{children:[W,"°"]}),e[55]=W,e[56]=q):q=e[56];const Ne=t.latitudeRef||"N";let Y;e[57]!==Ne?(Y=s.jsx("span",{children:Ne}),e[57]=Ne,e[58]=Y):Y=e[58];let he;e[59]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx("span",{children:", "}),e[59]=he):he=e[59];let J;e[60]!==t.longitude?(J=Math.abs(t.longitude).toFixed(4),e[60]=t.longitude,e[61]=J):J=e[61];let Q;e[62]!==J?(Q=s.jsxs("span",{children:[J,"°"]}),e[62]=J,e[63]=Q):Q=e[63];const Se=t.longitudeRef||"E";let X;e[64]!==Se?(X=s.jsx("span",{children:Se}),e[64]=Se,e[65]=X):X=e[65];let ee;e[66]!==q||e[67]!==Y||e[68]!==Q||e[69]!==X?(ee=s.jsxs("div",{className:"flex items-center gap-2",children:[fe,s.jsxs("span",{className:"font-mono",children:[q,Y,he,Q,X]})]}),e[66]=q,e[67]=Y,e[68]=Q,e[69]=X,e[70]=ee):ee=e[70];let te;e[71]!==t.altitude||e[72]!==t.altitudeRef?(te=t.altitude!==void 0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("i",{className:"i-mingcute-mountain-2-line text-sm"}),s.jsxs("span",{className:"font-mono",children:[s.jsx("span",{children:t.altitudeRef==="Below Sea Level"?"-":""}),s.jsxs("span",{children:[Math.abs(t.altitude).toFixed(1),"m"]})]})]}),e[71]=t.altitude,e[72]=t.altitudeRef,e[73]=te):te=e[73];let se;e[74]!==ee||e[75]!==te?(se=s.jsxs("div",{className:"text-text-secondary space-y-1 text-xs",children:[ee,te]}),e[74]=ee,e[75]=te,e[76]=se):se=e[76];let oe;e[77]!==V||e[78]!==K||e[79]!==se?(oe=s.jsxs("div",{className:"space-y-2",children:[V,K,se]}),e[77]=V,e[78]=K,e[79]=se,e[80]=oe):oe=e[80];let ie;e[81]!==G||e[82]!==oe?(ie=s.jsxs("div",{className:"space-y-3 p-4",children:[G,oe]}),e[81]=G,e[82]=oe,e[83]=ie):ie=e[83];let le;e[84]!==A||e[85]!==Z||e[86]!==ie?(le=s.jsxs("div",{className:"relative",children:[A,Z,ie]}),e[84]=A,e[85]=Z,e[86]=ie,e[87]=le):le=e[87];let ne;e[88]!==I||e[89]!==U||e[90]!==F||e[91]!==le?(ne=s.jsx($e,{className:I,side:"top",align:"center",sideOffset:8,onPointerDownOutside:U,onEscapeKeyDown:F,children:le}),e[88]=I,e[89]=U,e[90]=F,e[91]=le,e[92]=ne):ne=e[92];let ae;e[93]!==R||e[94]!==ne||e[95]!==N||e[96]!==S||e[97]!==L?(ae=s.jsxs(ze,{open:N,openDelay:S,closeDelay:L,children:[R,ne]}),e[93]=R,e[94]=ne,e[95]=N,e[96]=S,e[97]=L,e[98]=ae):ae=e[98];let me;return e[99]!==t.id||e[100]!==t.latitude||e[101]!==t.longitude||e[102]!==ae?(me=s.jsx(Te,{longitude:k,latitude:b,children:ae},d),e[99]=t.id,e[100]=t.latitude,e[101]=t.longitude,e[102]=ae,e[103]=me):me=e[103],me};function pt(o){return o.preventDefault()}function bt(o){return o.preventDefault()}const yt={longitude:-122.4,latitude:37.8,zoom:14},vt=[],jt={width:"100%",height:"100%"},Mt=({id:o,initialViewState:e=yt,markers:t=vt,selectedMarkerId:l,geoJsonData:a,onMarkerClick:n,onGeoJsonClick:i,onGeolocate:r,onClusterClick:h,className:x="w-full h-full",style:u=jt,mapRef:d,autoFitBounds:k=!0})=>{const[b,N]=_.useState(e.zoom),[S,L]=_.useState(e),[v,j]=_.useState(!1),[y,g]=_.useState(!1),m=_.useCallback(c=>{n?.(c)},[n]),p=_.useCallback(()=>{if(l&&n){const c=t.find(w=>w.id===l);c&&n(c)}},[l,n,t]),C=_.useMemo(()=>it(t,b),[t,b]),E=_.useCallback((c,w)=>{const f=Math.max(c,w);return f<.001?16:f<.01?14:f<.1?11:f<1?8:f<10?5:2},[]),M=_.useCallback(()=>{if(!k||t.length===0||!v||y)return;const c=Fe(t);if(!c)return;if(g(!0),t.length===1){const f={longitude:t[0].longitude,latitude:t[0].latitude,zoom:13};L(f),N(f.zoom);return}if(d?.current?.getMap){const f=d.current.getContainer(),H=f.offsetWidth,z=f.offsetHeight,$=.1,D=H*$,R=z*$,I={top:Math.max(R,40),bottom:Math.max(R,40),left:Math.max(D,40),right:Math.max(D,40)};try{d.current.getMap().fitBounds([[c.minLng,c.minLat],[c.maxLng,c.maxLat]],{padding:I,duration:800,maxZoom:15})}catch(U){console.warn("使用 fitBounds 失败，使用备用方案:",U),w(c)}}else w(c);function w(f){if(!f)return;const H=f.maxLat-f.minLat,z=f.maxLng-f.minLng,$=Math.max(E(H,z)-1,2),D={longitude:f.centerLng,latitude:f.centerLat,zoom:$};L(D),N($)}},[t,k,v,d,E,y]),T=_.useCallback(()=>{if(j(!0),d?.current?.getMap){const c=d.current.getMap(),w=Oe.mapProjection||"mercator";c.setProjection({type:w})}},[]);return _.useEffect(()=>{const c=setTimeout(()=>{M()},100);return()=>clearTimeout(c)},[M]),s.jsx("div",{className:x,style:u,children:s.jsxs(Ae,{id:o,ref:d,...S,style:{width:"100%",height:"100%"},mapStyle:Ie(),attributionControl:!1,interactiveLayerIds:a?["data"]:void 0,onClick:i,onLoad:T,onMove:c=>{N(c.viewState.zoom),L(c.viewState)},children:[s.jsx(mt,{onGeolocate:r}),C.map(c=>{if(c.properties.cluster)return s.jsx(ct,{longitude:c.geometry.coordinates[0],latitude:c.geometry.coordinates[1],pointCount:c.properties.point_count||0,representativeMarker:c.properties.marker,clusteredPhotos:c.properties.clusteredPhotos,onClusterClick:h},`cluster-${c.geometry.coordinates[0]}-${c.geometry.coordinates[1]}`);{const{marker:w}=c.properties;return w?s.jsx(gt,{marker:w,isSelected:l===w.id,onClick:m,onClose:p},w.id):null}}),a&&s.jsx(ht,{data:a})]})})};export{Mt as Maplibre};
